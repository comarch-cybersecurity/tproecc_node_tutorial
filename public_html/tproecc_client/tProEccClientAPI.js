require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({"/helpers/errorCodes.js":[function(require,module,exports){function errorCodes(){this.EXIT_CODE_CANCEL=1;this.EXIT_CODE_VALIDATE_ERROR=2;this.EXIT_CODE_ACTION_ERROR=3;this.EXIT_CODE_TERMINATED=4;this.EXIT_CODE_CONNECTION_CLOSED=5;this.EXIT_CODE_CONNECTION_ERROR=6;this.EXIT_CODE_WRONG_DATA_LENGTH=7;this.EXIT_CODE_WRONG_BSON=8;this.EXIT_CODE_NO_TOKEN=9;this.EXIT_CODE_PIN_INVALID=36;this.EXIT_CODE_PIN_BLOCKED=38;this.EXIT_CODE_KEY_NOT_FOUND=40}errorCodes.prototype.getError=function(error){return{err:error,desc:this.getErrDesc(error)}};errorCodes.prototype.getErrDesc=function(error){switch(error){case this.EXIT_CODE_CANCEL:{return"Operation canceled";break}case this.EXIT_CODE_VALIDATE_ERROR:{return"Validation error";break}case this.EXIT_CODE_ACTION_ERROR:{return"Operation error";break}case this.EXIT_CODE_CONNECTION_CLOSED:{return"Connection with device has been closed";break}case this.EXIT_CODE_CONNECTION_ERROR:{return"Cannot connect to device";break}case this.EXIT_CODE_WRONG_DATA_LENGTH:{return"Wrong response from device";break}case this.EXIT_CODE_WRONG_BSON:{return"Wrong response from device";break}case this.EXIT_CODE_PIN_INVALID:{return"Invalid PIN";break}case this.EXIT_CODE_PIN_BLOCKED:{return"PIN is blocked";break}case this.EXIT_CODE_KEY_NOT_FOUND:{return"Cannot find key on device";break}case this.EXIT_CODE_NO_TOKEN:{return"no token inserted";break}default:{return"UNKNOWN ERROR:"+error;break}}};module.exports=errorCodes},{}],"/helpers/functions.js":[function(require,module,exports){var debugTextAreaName=null;var g_keyIdsArray=[];function debugResult(result){var textArea=$(debugTextAreaName);textArea.val(textArea.val()+result+"\n")}function setDebugTextAreaName(textArea){if(textArea.charAt(0)!="#"){return}debugTextAreaName=textArea}function clearDebug(){if(debugTextAreaName!=null){$(debugTextAreaName).val("")}}setDebugTextAreaName("#textareaResult");function funCallbackTest(result){if(debugTextAreaName!=null){debugResult(result)}}function funGenKeyCallbackTest(result){funCallbackTest(result);var values=result.split("|");if(values.length<1){return}if(values[0]==="0"&&values.length===6){var keyId=guidGenerator();var keyName=values[1];var keyFingerprint=values[5];var keyLocation=values[2];var callback=function(keyId){return function(result){funSetKeyCallbackTest(result,keyId)}}(keyId);SetKey(keyId,keyName,keyFingerprint,keyLocation,callback)}}function funSetKeyCallbackTest(result,keyId){funCallbackTest(result);var values=result.split("|");if(values.length<1){return}if(values[0]==="0"){g_keyIdsArray.push(keyId)}}function SampleIBANTable(){return"AD-24|AT-20|BE-16|BG-22|CH-21|CS-22|CS-22|CS-22|CY-28|CZ-24|DE-22|DK-18|EE-20|ES-24|FI-18|FO-18|FR-27|GB-22|GB-22|GB-22|GB-22|GI-23|GL-18|GR-27|HU-28|IE-22|IE-22|IS-26|IT-27|LI-21|LT-20|LU-20|LV-21|MC-27|ME-22|ME-22|ME-22|MT-31|NL-18|NO-15|PL-28|PT-25|RO-24|RS-22|RS-22|RS-22|SE-24|SI-19|SK-24|SM-27"}function keyIds(){if(g_keyIdsArray.length<1){return"||"}var result="";for(var i=0;i<g_keyIdsArray.length;++i){result=result+"|"+g_keyIdsArray[i].toString()}result+="|";return result}function defKey(){if(g_keyIdsArray.length>0){return g_keyIdsArray[0]}else{return""}}function notIbanAllowedChars(){return",.-"}function notIbanRemoveChars(){return" "}function accountType(){return"1"}function languagePL(){return"0"}function languageEN(){return"1"}function keyLength(){return"|4|"}function stringToHex(tmp){var str="",i=0,tmp_len=tmp.length,c;for(;i<tmp_len;i+=1){c=tmp.charCodeAt(i);str+=d2h(c)+" "}return str}function string2Hex(tmp){var str="",i=0,tmp_len=tmp.length,c;for(;i<tmp_len;i+=1){c=tmp.charCodeAt(i);str+=d2h(c)}return str}function parseHexString(str){var result=[];while(str.length>=2){result.push(parseInt(str.substring(0,2),16));str=str.substring(2,str.length)}return result}function hexToString(tmp){var tmpCharsHex=tmp.match(/[\s\S]{1,2}/g)||[];var formattedTmpHex=tmpCharsHex.join(" ");var arr=formattedTmpHex.split(" "),str="",i=0,arr_len=arr.length,c;for(;i<arr_len;i+=1){c=String.fromCharCode(h2d(arr[i]));str+=c}return str}function d2h(d){var tmp=d.toString(16);if(tmp.length%2!==0){return"0"+tmp}return tmp}function h2d(h){return parseInt(h,16)}function guidGenerator(){var buf=new Uint16Array(8);window.crypto.getRandomValues(buf);var S4=function(num){var ret=num.toString(16);while(ret.length<4){ret="0"+ret}return ret};return S4(buf[0])+S4(buf[1])+"-"+S4(buf[2])+"-4"+S4(buf[3]).substring(1)+"-y"+S4(buf[4]).substring(1)+"-"+S4(buf[5])+S4(buf[6])+S4(buf[7])}function calcHash(dataBytes){return sha256(dataBytes,false)}function utils(){}utils.prototype.bytesToHex=function(bytes){for(var hex=[],i=0;i<bytes.length;i++){hex.push((bytes[i]>>>4).toString(16));hex.push((bytes[i]&15).toString(16))}return hex.join("")};utils.prototype.decToHex=function(dec){var hex=dec.toString(16);if(hex.length%2!==0){hex="0"+hex}return hex};utils.prototype.stringToHex=function(string){var hex="";var stringLen=string.length;for(var i=0;i<stringLen;i++){hex+=this.decToHex(string.charCodeAt(i))}return hex};utils.prototype.appendTextZeros=function(dataString,appendLength){for(var i=appendLength;i>0;i--){dataString+="0"}return dataString};utils.prototype.makeStringWithFixedLength=function(dataString,requiredLen){var stringLengh=dataString.length;if(stringLengh<requiredLen){dataString=this.appendTextZeros(dataString,requiredLen-stringLengh)}else{dataString=dataString.substring(0,requiredLen)}return dataString};utils.prototype.hexToBytes=function(hex){for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return new Uint8Array(bytes)};utils.prototype.findResPos=function(app,res){var appSizeBuf=new Uint8Array(this.hexToBytes(app.substr(128,4)));var appSize=appSizeBuf[0]*256+appSizeBuf[1];return 128+4+appSize*2+app.substr(128+4+appSize*2).search(res)};utils.prototype.replaceRes=function(app,resTemp,resValue){var resValueHex=this.makeStringWithFixedLength(resValue,resTemp.length);var resValuePos=this.findResPos(app,resTemp);if(resValuePos>=0)app=app.substring(0,resValuePos)+resValueHex+app.substring(resValuePos+resTemp.length);return app};utils.prototype.makeLenght=function(len){var res=this.decToHex(len);if(res.length>4)return"";if(res.length>2){return res.substing(2,4)+res.substring(0,2)}else{return res+"00"}};utils.prototype.replaceResAndSize=function(app,resTemp,resValue){var lenghtHex=this.makeLenght(resValue.length/2);if(lenghtHex.length==0)return app;var resValueHex=this.makeStringWithFixedLength(resValue,resTemp.length);var resValuePos=this.findResPos(app,resTemp);if(resValuePos>=0)app=app.substring(0,resValuePos-4)+lenghtHex+resValueHex+app.substring(resValuePos+resTemp.length);return app};module.exports=utils},{}],"/helpers/ws.js":[function(require,module,exports){var utils=require("./functions.js");var u=new utils;var b=require("bson");var BSON=new b;var err=require("./errorCodes.js");var e=new err;var Buffer=require("buffer").Buffer;var com_type=1;var busy=0;function communication(){}function bson2json(obj){var n,v,json={};for(n in obj){v=obj[n];t=typeof v;if(t=="object"&&v!==null&&v._bsontype=="Binary")v=u.bytesToHex(v.buffer);else if(t=="object"&&v!==null)v=bson2json(v);json[n]=v}return json}function log_msg(str){var d=new Date;console.log(d.toLocaleTimeString()+" "+str)}communication.prototype.doConnect=function(message,callback){log_msg("doconnect begin");if(busy!==0){callback(e.getError(e.EXIT_CODE_CONNECTION_ERROR),"");return}busy=1;var received=false;var opened=false;log_msg("doconnect");if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}else if(!window.WebSocket){return}var uri="wss://tprodevice.comarch.com?encoding=text";var websocket=new WebSocket(uri);log_msg("doconnect - "+websocket.readyState);websocket.binaryType="arraybuffer";websocket.onopen=function(event){log_msg("onopen type: "+com_type+" "+message);opened=true;var bytes;if(com_type===0){bytes=u.hexToBytes("000000"+message.substring(128))}else{bytes=u.hexToBytes("200000"+message);bytes[2]=(message.length-128)/2>>>8;bytes[1]=(message.length-128)/2}websocket.send(bytes)};websocket.onmessage=function(event){received=true;websocket.close();var result=new Uint8Array(event.data);var statusCode=result[5];var typeCode=result[4];var fr=result[0]+result[1]*256+result[2]*256*256+result[3]*256*256*256;log_msg("onmessage ("+statusCode+") "+typeCode+" fr: "+fr);if(typeCode>0){com_type=1}else{com_type=0}if(statusCode===0){var dataLength=result[6]+256*result[7];var bsonData=new Uint8Array(event.data,8,dataLength);var buf=Buffer.from(bsonData);if(dataLength===0){callback(null,null)}else if(dataLength<=bsonData.length){var b;try{b=BSON.deserialize(buf)}catch(err){callback(e.getError(e.EXIT_CODE_WRONG_BSON),"")}callback(null,bson2json(b))}else{callback(e.getError(e.EXIT_CODE_WRONG_DATA_LENGTH),"")}}else{callback(e.getError(statusCode),"")}};websocket.onclose=function(event){log_msg("onclose ");busy=0;if(opened&&!received){callback(e.getError(e.EXIT_CODE_CONNECTION_CLOSED),"");log_msg("onclose EXIT_CODE_CONNECTION_CLOSED ")}};websocket.onerror=function(event){log_msg("onerror ");busy=0;websocket.close();if(opened&&!received||!opened){callback(e.getError(e.EXIT_CODE_CONNECTION_ERROR),"");log_msg("onerror EXIT_CODE_CONNECTION_CLOSED ")}}};module.exports=communication},{"./errorCodes.js":"/helpers/errorCodes.js","./functions.js":"/helpers/functions.js",bson:"bson",buffer:28}],1:[function(require,module,exports){(function(global){if(typeof global!=="undefined"){var Buffer=require("buffer").Buffer}function Binary(buffer,subType){if(!(this instanceof Binary))return new Binary(buffer,subType);this._bsontype="Binary";if(buffer instanceof Number){this.sub_type=buffer;this.position=0}else{this.sub_type=subType==null?BSON_BINARY_SUBTYPE_DEFAULT:subType;this.position=0}if(buffer!=null&&!(buffer instanceof Number)){if(typeof buffer=="string"){if(typeof Buffer!="undefined"){this.buffer=new Buffer(buffer)}else if(typeof Uint8Array!="undefined"||Object.prototype.toString.call(buffer)=="[object Array]"){this.buffer=writeStringToArray(buffer)}else{throw new Error("only String, Buffer, Uint8Array or Array accepted")}}else{this.buffer=buffer}this.position=buffer.length}else{if(typeof Buffer!="undefined"){this.buffer=new Buffer(Binary.BUFFER_SIZE)}else if(typeof Uint8Array!="undefined"){this.buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE))}else{this.buffer=new Array(Binary.BUFFER_SIZE)}this.position=0}}Binary.prototype.put=function put(byte_value){if(byte_value["length"]!=null&&typeof byte_value!="number"&&byte_value.length!=1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof byte_value!="number"&&byte_value<0||byte_value>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var decoded_byte=null;if(typeof byte_value=="string"){decoded_byte=byte_value.charCodeAt(0)}else if(byte_value["length"]!=null){decoded_byte=byte_value[0]}else{decoded_byte=byte_value}if(this.buffer.length>this.position){this.buffer[this.position++]=decoded_byte}else{if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){var buffer=new Buffer(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(buffer,0,0,this.buffer.length);this.buffer=buffer;this.buffer[this.position++]=decoded_byte}else{var buffer=null;if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE+this.buffer.length))}else{buffer=new Array(Binary.BUFFER_SIZE+this.buffer.length)}for(var i=0;i<this.buffer.length;i++){buffer[i]=this.buffer[i]}this.buffer=buffer;this.buffer[this.position++]=decoded_byte}}};Binary.prototype.write=function write(string,offset){offset=typeof offset=="number"?offset:this.position;if(this.buffer.length<offset+string.length){var buffer=null;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){buffer=new Buffer(this.buffer.length+string.length);this.buffer.copy(buffer,0,0,this.buffer.length)}else if(Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"){buffer=new Uint8Array(new ArrayBuffer(this.buffer.length+string.length));for(var i=0;i<this.position;i++){buffer[i]=this.buffer[i]}}this.buffer=buffer}if(typeof Buffer!="undefined"&&Buffer.isBuffer(string)&&Buffer.isBuffer(this.buffer)){string.copy(this.buffer,offset,0,string.length);this.position=offset+string.length>this.position?offset+string.length:this.position}else if(typeof Buffer!="undefined"&&typeof string=="string"&&Buffer.isBuffer(this.buffer)){this.buffer.write(string,offset,"binary");this.position=offset+string.length>this.position?offset+string.length:this.position}else if(Object.prototype.toString.call(string)=="[object Uint8Array]"||Object.prototype.toString.call(string)=="[object Array]"&&typeof string!="string"){for(var i=0;i<string.length;i++){this.buffer[offset++]=string[i]}this.position=offset>this.position?offset:this.position}else if(typeof string=="string"){for(var i=0;i<string.length;i++){this.buffer[offset++]=string.charCodeAt(i)}this.position=offset>this.position?offset:this.position}};Binary.prototype.read=function read(position,length){length=length&&length>0?length:this.position;if(this.buffer["slice"]){return this.buffer.slice(position,position+length)}else{var buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(length)):new Array(length);for(var i=0;i<length;i++){buffer[i]=this.buffer[position++]}}return buffer};Binary.prototype.value=function value(asRaw){asRaw=asRaw==null?false:asRaw;if(asRaw&&typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)&&this.buffer.length==this.position)return this.buffer;if(typeof Buffer!="undefined"&&Buffer.isBuffer(this.buffer)){return asRaw?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)}else{if(asRaw){if(this.buffer["slice"]!=null){return this.buffer.slice(0,this.position)}else{var newBuffer=Object.prototype.toString.call(this.buffer)=="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position);for(var i=0;i<this.position;i++){newBuffer[i]=this.buffer[i]}return newBuffer}}else{return convertArraytoUtf8BinaryString(this.buffer,0,this.position)}}};Binary.prototype.length=function length(){return this.position};Binary.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""};Binary.prototype.toString=function(format){return this.buffer!=null?this.buffer.slice(0,this.position).toString(format):""};var BSON_BINARY_SUBTYPE_DEFAULT=0;var writeStringToArray=function(data){var buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(data.length)):new Array(data.length);for(var i=0;i<data.length;i++){buffer[i]=data.charCodeAt(i)}return buffer};var convertArraytoUtf8BinaryString=function(byteArray,startIndex,endIndex){var result="";for(var i=startIndex;i<endIndex;i++){result=result+String.fromCharCode(byteArray[i])}return result};Binary.BUFFER_SIZE=256;Binary.SUBTYPE_DEFAULT=0;Binary.SUBTYPE_FUNCTION=1;Binary.SUBTYPE_BYTE_ARRAY=2;Binary.SUBTYPE_UUID_OLD=3;Binary.SUBTYPE_UUID=4;Binary.SUBTYPE_MD5=5;Binary.SUBTYPE_USER_DEFINED=128;module.exports=Binary;module.exports.Binary=Binary}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:28}],2:[function(require,module,exports){var Code=function Code(code,scope){if(!(this instanceof Code))return new Code(code,scope);this._bsontype="Code";this.code=code;this.scope=scope};Code.prototype.toJSON=function(){return{scope:this.scope,code:this.code}};module.exports=Code;module.exports.Code=Code},{}],3:[function(require,module,exports){function DBRef(namespace,oid,db){if(!(this instanceof DBRef))return new DBRef(namespace,oid,db);this._bsontype="DBRef";this.namespace=namespace;this.oid=oid;this.db=db}DBRef.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:this.db==null?"":this.db}};module.exports=DBRef;module.exports.DBRef=DBRef},{}],4:[function(require,module,exports){(function(Buffer){"use strict";var Long=require("./long");var PARSE_STRING_REGEXP=/^(\+|\-)?(\d+|(\d*\.\d*))?(E|e)?([\-\+])?(\d+)?$/;var PARSE_INF_REGEXP=/^(\+|\-)?(Infinity|inf)$/i;var PARSE_NAN_REGEXP=/^(\+|\-)?NaN$/i;var EXPONENT_MAX=6111;var EXPONENT_MIN=-6176;var EXPONENT_BIAS=6176;var MAX_DIGITS=34;var NAN_BUFFER=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var INF_NEGATIVE_BUFFER=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var INF_POSITIVE_BUFFER=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var EXPONENT_REGEX=/^([\-\+])?(\d+)?$/;var isDigit=function(value){return!isNaN(parseInt(value,10))};var divideu128=function(value){var DIVISOR=Long.fromNumber(1e3*1e3*1e3);var _rem=Long.fromNumber(0);var i=0;if(!value.parts[0]&&!value.parts[1]&&!value.parts[2]&&!value.parts[3]){return{quotient:value,rem:_rem}}for(var i=0;i<=3;i++){_rem=_rem.shiftLeft(32);_rem=_rem.add(new Long(value.parts[i],0));value.parts[i]=_rem.div(DIVISOR).low_;_rem=_rem.modulo(DIVISOR)}return{quotient:value,rem:_rem}};var multiply64x2=function(left,right){if(!left&&!right){return{high:Long.fromNumber(0),low:Long.fromNumber(0)}}var leftHigh=left.shiftRightUnsigned(32);var leftLow=new Long(left.getLowBits(),0);var rightHigh=right.shiftRightUnsigned(32);var rightLow=new Long(right.getLowBits(),0);var productHigh=leftHigh.multiply(rightHigh);var productMid=leftHigh.multiply(rightLow);var productMid2=leftLow.multiply(rightHigh);var productLow=leftLow.multiply(rightLow);productHigh=productHigh.add(productMid.shiftRightUnsigned(32));productMid=new Long(productMid.getLowBits(),0).add(productMid2).add(productLow.shiftRightUnsigned(32));productHigh=productHigh.add(productMid.shiftRightUnsigned(32));productLow=productMid.shiftLeft(32).add(new Long(productLow.getLowBits(),0));return{high:productHigh,low:productLow}};var lessThan=function(left,right){var uhleft=left.high_>>>0;var uhright=right.high_>>>0;if(uhleft<uhright){return true}else if(uhleft==uhright){var ulleft=left.low_>>>0;var ulright=right.low_>>>0;if(ulleft<ulright)return true}return false};var longtoHex=function(value){var buffer=new Buffer(8);var index=0;buffer[index++]=value.low_&255;buffer[index++]=value.low_>>8&255;buffer[index++]=value.low_>>16&255;buffer[index++]=value.low_>>24&255;buffer[index++]=value.high_&255;buffer[index++]=value.high_>>8&255;buffer[index++]=value.high_>>16&255;buffer[index++]=value.high_>>24&255;return buffer.reverse().toString("hex")};var int32toHex=function(value){var buffer=new Buffer(4);var index=0;buffer[index++]=value&255;buffer[index++]=value>>8&255;buffer[index++]=value>>16&255;buffer[index++]=value>>24&255;return buffer.reverse().toString("hex")};var Decimal128=function(bytes){this._bsontype="Decimal128";this.bytes=bytes};Decimal128.fromString=function(string){var isNegative=false;var sawRadix=false;var foundNonZero=false;var significantDigits=0;var nDigitsRead=0;var nDigits=0;var radixPosition=0;var firstNonZero=0;var digits=[0];var nDigitsStored=0;var digitsInsert=0;var firstDigit=0;var lastDigit=0;var exponent=0;var i=0;var significandHigh=[0,0];var significandLow=[0,0];var biasedExponent=0;var index=0;string=string.trim();var stringMatch=string.match(PARSE_STRING_REGEXP);var infMatch=string.match(PARSE_INF_REGEXP);var nanMatch=string.match(PARSE_NAN_REGEXP);if(!stringMatch&&!infMatch&&!nanMatch||string.length==0){throw new Error(""+string+" not a valid Decimal128 string")}if(stringMatch&&stringMatch[4]&&stringMatch[2]===undefined){throw new Error(""+string+" not a valid Decimal128 string")}if(string[index]=="+"||string[index]=="-"){isNegative=string[index++]=="-"}if(!isDigit(string[index])&&string[index]!="."){if(string[index]=="i"||string[index]=="I"){return new Decimal128(new Buffer(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER))}else if(string[index]=="N"){return new Decimal128(new Buffer(NAN_BUFFER))}}while(isDigit(string[index])||string[index]=="."){if(string[index]=="."){if(sawRadix){return new Decimal128(new Buffer(NAN_BUFFER))}sawRadix=true;index=index+1;continue}if(nDigitsStored<34){if(string[index]!="0"||foundNonZero){if(!foundNonZero){firstNonZero=nDigitsRead}foundNonZero=true;digits[digitsInsert++]=parseInt(string[index],10);nDigitsStored=nDigitsStored+1}}if(foundNonZero){nDigits=nDigits+1}if(sawRadix){radixPosition=radixPosition+1}nDigitsRead=nDigitsRead+1;index=index+1}if(sawRadix&&!nDigitsRead){throw new Error(""+string+" not a valid Decimal128 string")}if(string[index]=="e"||string[index]=="E"){var match=string.substr(++index).match(EXPONENT_REGEX);if(!match||!match[2]){return new Decimal128(new Buffer(NAN_BUFFER))}exponent=parseInt(match[0],10);index=index+match[0].length}if(string[index]){return new Decimal128(new Buffer(NAN_BUFFER))}firstDigit=0;if(!nDigitsStored){firstDigit=0;lastDigit=0;digits[0]=0;nDigits=1;nDigitsStored=1;significantDigits=0}else{lastDigit=nDigitsStored-1;significantDigits=nDigits;if(exponent!=0&&significantDigits!=1){while(string[firstNonZero+significantDigits-1]=="0"){significantDigits=significantDigits-1}}}if(exponent<=radixPosition&&radixPosition-exponent>1<<14){exponent=EXPONENT_MIN}else{exponent=exponent-radixPosition}while(exponent>EXPONENT_MAX){lastDigit=lastDigit+1;if(lastDigit-firstDigit>MAX_DIGITS){var digitsString=digits.join("");if(digitsString.match(/^0+$/)){exponent=EXPONENT_MAX;break}else{return new Decimal128(new Buffer(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER))}}exponent=exponent-1}while(exponent<EXPONENT_MIN||nDigitsStored<nDigits){if(lastDigit==0){exponent=EXPONENT_MIN;significantDigits=0;break}if(nDigitsStored<nDigits){nDigits=nDigits-1}else{lastDigit=lastDigit-1}if(exponent<EXPONENT_MAX){exponent=exponent+1}else{var digitsString=digits.join("");if(digitsString.match(/^0+$/)){exponent=EXPONENT_MAX;break}else{return new Decimal128(new Buffer(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER))}}}if(lastDigit-firstDigit+1<significantDigits&&string[significantDigits]!="0"){var endOfString=nDigitsRead;if(sawRadix&&exponent==EXPONENT_MIN){firstNonZero=firstNonZero+1;endOfString=endOfString+1}var roundDigit=parseInt(string[firstNonZero+lastDigit+1],10);var roundBit=0;if(roundDigit>=5){roundBit=1;if(roundDigit==5){roundBit=digits[lastDigit]%2==1;for(var i=firstNonZero+lastDigit+2;i<endOfString;i++){if(parseInt(string[i],10)){roundBit=1;break}}}}if(roundBit){var dIdx=lastDigit;for(;dIdx>=0;dIdx--){if(++digits[dIdx]>9){digits[dIdx]=0;if(dIdx==0){if(exponent<EXPONENT_MAX){exponent=exponent+1;digits[dIdx]=1}else{return new Decimal128(new Buffer(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER))}}}else{break}}}}significandHigh=Long.fromNumber(0);significandLow=Long.fromNumber(0);if(significantDigits==0){significandHigh=Long.fromNumber(0);significandLow=Long.fromNumber(0)}else if(lastDigit-firstDigit<17){var dIdx=firstDigit;significandLow=Long.fromNumber(digits[dIdx++]);significandHigh=new Long(0,0);for(;dIdx<=lastDigit;dIdx++){significandLow=significandLow.multiply(Long.fromNumber(10));significandLow=significandLow.add(Long.fromNumber(digits[dIdx]))}}else{var dIdx=firstDigit;significandHigh=Long.fromNumber(digits[dIdx++]);for(;dIdx<=lastDigit-17;dIdx++){significandHigh=significandHigh.multiply(Long.fromNumber(10));significandHigh=significandHigh.add(Long.fromNumber(digits[dIdx]))}significandLow=Long.fromNumber(digits[dIdx++]);for(;dIdx<=lastDigit;dIdx++){significandLow=significandLow.multiply(Long.fromNumber(10));significandLow=significandLow.add(Long.fromNumber(digits[dIdx]))}}var significand=multiply64x2(significandHigh,Long.fromString("100000000000000000"));significand.low=significand.low.add(significandLow);if(lessThan(significand.low,significandLow)){significand.high=significand.high.add(Long.fromNumber(1))}var biasedExponent=exponent+EXPONENT_BIAS;var dec={low:Long.fromNumber(0),high:Long.fromNumber(0)};if(significand.high.shiftRightUnsigned(49).and(Long.fromNumber(1)).equals(Long.fromNumber)){dec.high=dec.high.or(Long.fromNumber(3).shiftLeft(61));dec.high=dec.high.or(Long.fromNumber(biasedExponent).and(Long.fromNumber(16383).shiftLeft(47)));dec.high=dec.high.or(significand.high.and(Long.fromNumber(0x7fffffffffff)))}else{dec.high=dec.high.or(Long.fromNumber(biasedExponent&16383).shiftLeft(49));dec.high=dec.high.or(significand.high.and(Long.fromNumber(562949953421311)))}dec.low=significand.low;if(isNegative){dec.high=dec.high.or(Long.fromString("9223372036854775808"))}var buffer=new Buffer(16);var index=0;buffer[index++]=dec.low.low_&255;buffer[index++]=dec.low.low_>>8&255;buffer[index++]=dec.low.low_>>16&255;buffer[index++]=dec.low.low_>>24&255;buffer[index++]=dec.low.high_&255;buffer[index++]=dec.low.high_>>8&255;buffer[index++]=dec.low.high_>>16&255;buffer[index++]=dec.low.high_>>24&255;buffer[index++]=dec.high.low_&255;buffer[index++]=dec.high.low_>>8&255;buffer[index++]=dec.high.low_>>16&255;buffer[index++]=dec.high.low_>>24&255;buffer[index++]=dec.high.high_&255;buffer[index++]=dec.high.high_>>8&255;buffer[index++]=dec.high.high_>>16&255;buffer[index++]=dec.high.high_>>24&255;return new Decimal128(buffer)};var COMBINATION_MASK=31;var EXPONENT_MASK=16383;var COMBINATION_INFINITY=30;var COMBINATION_NAN=31;var COMBINATION_SNAN=32;var EXPONENT_BIAS=6176;Decimal128.prototype.toString=function(){var high;var midh;var midl;var low;var combination;var biased_exponent;var significand_digits=0;var significand=new Array(36);for(var i=0;i<significand.length;i++)significand[i]=0;var index=0;var exponent;var scientific_exponent;var is_zero=false;var significand_msb;var significand128={parts:new Array(4)};var i;var j,k;var string=[];var index=0;var buffer=this.bytes;low=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;midl=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;midh=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;high=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var index=0;var dec={low:new Long(low,midl),high:new Long(midh,high)};if(dec.high.lessThan(Long.ZERO)){string.push("-")}combination=high>>26&COMBINATION_MASK;if(combination>>3==3){if(combination==COMBINATION_INFINITY){return string.join("")+"Infinity"}else if(combination==COMBINATION_NAN){return"NaN"}else{biased_exponent=high>>15&EXPONENT_MASK;significand_msb=8+(high>>14&1)}}else{significand_msb=high>>14&7;biased_exponent=high>>17&EXPONENT_MASK}exponent=biased_exponent-EXPONENT_BIAS;significand128.parts[0]=(high&16383)+((significand_msb&15)<<14);significand128.parts[1]=midh;significand128.parts[2]=midl;significand128.parts[3]=low;if(significand128.parts[0]==0&&significand128.parts[1]==0&&significand128.parts[2]==0&&significand128.parts[3]==0){is_zero=true}else{for(var k=3;k>=0;k--){var least_digits=0;var result=divideu128(significand128);significand128=result.quotient;least_digits=result.rem.low_;if(!least_digits)continue;for(var j=8;j>=0;j--){significand[k*9+j]=least_digits%10;least_digits=Math.floor(least_digits/10)}}}if(is_zero){significand_digits=1;significand[index]=0}else{significand_digits=36;var i=0;while(!significand[index]){i++;significand_digits=significand_digits-1;index=index+1}}scientific_exponent=significand_digits-1+exponent;if(scientific_exponent>=34||scientific_exponent<=-7||exponent>0){string.push(significand[index++]);significand_digits=significand_digits-1;if(significand_digits){string.push(".")}for(var i=0;i<significand_digits;i++){string.push(significand[index++])}string.push("E");if(scientific_exponent>0){string.push("+"+scientific_exponent)}else{string.push(scientific_exponent)}}else{if(exponent>=0){for(var i=0;i<significand_digits;i++){string.push(significand[index++])}}else{var radix_position=significand_digits+exponent;if(radix_position>0){for(var i=0;i<radix_position;i++){string.push(significand[index++])}}else{string.push("0")}string.push(".");while(radix_position++<0){string.push("0")}for(var i=0;i<significand_digits-Math.max(radix_position-1,0);i++){string.push(significand[index++])}}}return string.join("")};Decimal128.prototype.toJSON=function(){return{$numberDecimal:this.toString()}};module.exports=Decimal128;module.exports.Decimal128=Decimal128}).call(this,require("buffer").Buffer)},{"./long":8,buffer:28}],5:[function(require,module,exports){function Double(value){if(!(this instanceof Double))return new Double(value);this._bsontype="Double";this.value=value}Double.prototype.valueOf=function(){return this.value};Double.prototype.toJSON=function(){return this.value};module.exports=Double;module.exports.Double=Double},{}],6:[function(require,module,exports){var readIEEE754=function(buffer,offset,endian,mLen,nBytes){var e,m,bBE=endian==="big",eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=bBE?0:nBytes-1,d=bBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};var writeIEEE754=function(buffer,value,offset,endian,mLen,nBytes){var e,m,c,bBE=endian==="big",eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=bBE?nBytes-1:0,d=bBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128};exports.readIEEE754=readIEEE754;exports.writeIEEE754=writeIEEE754},{}],7:[function(require,module,exports){var Int32=function(value){if(!(this instanceof Int32))return new Int32(value);this._bsontype="Int32";this.value=value};Int32.prototype.valueOf=function(){return this.value};Int32.prototype.toJSON=function(){return this.value};module.exports=Int32;module.exports.Int32=Int32},{}],8:[function(require,module,exports){function Long(low,high){if(!(this instanceof Long))return new Long(low,high);this._bsontype="Long";this.low_=low|0;this.high_=high|0}Long.prototype.toInt=function(){return this.low_};Long.prototype.toNumber=function(){return this.high_*Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Long.prototype.toJSON=function(){return this.toString()};Long.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){var radixLong=Long.fromNumber(radix);var div=this.div(radixLong);var rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=Long.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}};Long.prototype.getHighBits=function(){return this.high_};Long.prototype.getLowBits=function(){return this.low_};Long.prototype.getLowBitsUnsigned=function(){
return this.low_>=0?this.low_:Long.TWO_PWR_32_DBL_+this.low_};Long.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}};Long.prototype.isZero=function(){return this.high_==0&&this.low_==0};Long.prototype.isNegative=function(){return this.high_<0};Long.prototype.isOdd=function(){return(this.low_&1)==1};Long.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_};Long.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_};Long.prototype.lessThan=function(other){return this.compare(other)<0};Long.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0};Long.prototype.greaterThan=function(other){return this.compare(other)>0};Long.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0};Long.prototype.compare=function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}};Long.prototype.negate=function(){if(this.equals(Long.MIN_VALUE)){return Long.MIN_VALUE}else{return this.not().add(Long.ONE)}};Long.prototype.add=function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32)};Long.prototype.subtract=function(other){return this.add(other.negate())};Long.prototype.multiply=function(other){if(this.isZero()){return Long.ZERO}else if(other.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){return other.isOdd()?Long.MIN_VALUE:Long.ZERO}else if(other.equals(Long.MIN_VALUE)){return this.isOdd()?Long.MIN_VALUE:Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(Long.TWO_PWR_24_)&&other.lessThan(Long.TWO_PWR_24_)){return Long.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32)};Long.prototype.div=function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){if(other.equals(Long.ONE)||other.equals(Long.NEG_ONE)){return Long.MIN_VALUE}else if(other.equals(Long.MIN_VALUE)){return Long.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(Long.ZERO)){return other.isNegative()?Long.ONE:Long.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(Long.MIN_VALUE)){return Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=Long.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=Long.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=Long.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=Long.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res};Long.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))};Long.prototype.not=function(){return Long.fromBits(~this.low_,~this.high_)};Long.prototype.and=function(other){return Long.fromBits(this.low_&other.low_,this.high_&other.high_)};Long.prototype.or=function(other){return Long.fromBits(this.low_|other.low_,this.high_|other.high_)};Long.prototype.xor=function(other){return Long.fromBits(this.low_^other.low_,this.high_^other.high_)};Long.prototype.shiftLeft=function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return Long.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return Long.fromBits(0,low<<numBits-32)}}};Long.prototype.shiftRight=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return Long.fromBits(high>>numBits-32,high>=0?0:-1)}}};Long.prototype.shiftRightUnsigned=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return Long.fromBits(high,0)}else{return Long.fromBits(high>>>numBits-32,0)}}};Long.fromInt=function(value){if(-128<=value&&value<128){var cachedObj=Long.INT_CACHE_[value];if(cachedObj){return cachedObj}}var obj=new Long(value|0,value<0?-1:0);if(-128<=value&&value<128){Long.INT_CACHE_[value]=obj}return obj};Long.fromNumber=function(value){if(isNaN(value)||!isFinite(value)){return Long.ZERO}else if(value<=-Long.TWO_PWR_63_DBL_){return Long.MIN_VALUE}else if(value+1>=Long.TWO_PWR_63_DBL_){return Long.MAX_VALUE}else if(value<0){return Long.fromNumber(-value).negate()}else{return new Long(value%Long.TWO_PWR_32_DBL_|0,value/Long.TWO_PWR_32_DBL_|0)}};Long.fromBits=function(lowBits,highBits){return new Long(lowBits,highBits)};Long.fromString=function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return Long.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=Long.fromNumber(Math.pow(radix,8));var result=Long.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(Long.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(Long.fromNumber(value))}}return result};Long.INT_CACHE_={};Long.TWO_PWR_16_DBL_=1<<16;Long.TWO_PWR_24_DBL_=1<<24;Long.TWO_PWR_32_DBL_=Long.TWO_PWR_16_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_31_DBL_=Long.TWO_PWR_32_DBL_/2;Long.TWO_PWR_48_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_64_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_32_DBL_;Long.TWO_PWR_63_DBL_=Long.TWO_PWR_64_DBL_/2;Long.ZERO=Long.fromInt(0);Long.ONE=Long.fromInt(1);Long.NEG_ONE=Long.fromInt(-1);Long.MAX_VALUE=Long.fromBits(4294967295|0,2147483647|0);Long.MIN_VALUE=Long.fromBits(0,2147483648|0);Long.TWO_PWR_24_=Long.fromInt(1<<24);module.exports=Long;module.exports.Long=Long},{}],9:[function(require,module,exports){(function(global){"use strict";if(typeof global.Map!=="undefined"){module.exports=global.Map;module.exports.Map=global.Map}else{var Map=function(array){this._keys=[];this._values={};for(var i=0;i<array.length;i++){if(array[i]==null)continue;var entry=array[i];var key=entry[0];var value=entry[1];this._keys.push(key);this._values[key]={v:value,i:this._keys.length-1}}};Map.prototype.clear=function(){this._keys=[];this._values={}};Map.prototype.delete=function(key){var value=this._values[key];if(value==null)return false;delete this._values[key];this._keys.splice(value.i,1);return true};Map.prototype.entries=function(){var self=this;var index=0;return{next:function(){var key=self._keys[index++];return{value:key!==undefined?[key,self._values[key].v]:undefined,done:key!==undefined?false:true}}}};Map.prototype.forEach=function(callback,self){self=self||this;for(var i=0;i<this._keys.length;i++){var key=this._keys[i];callback.call(self,this._values[key].v,key,self)}};Map.prototype.get=function(key){return this._values[key]?this._values[key].v:undefined};Map.prototype.has=function(key){return this._values[key]!=null};Map.prototype.keys=function(key){var self=this;var index=0;return{next:function(){var key=self._keys[index++];return{value:key!==undefined?key:undefined,done:key!==undefined?false:true}}}};Map.prototype.set=function(key,value){if(this._values[key]){this._values[key].v=value;return this}this._keys.push(key);this._values[key]={v:value,i:this._keys.length-1};return this};Map.prototype.values=function(key,value){var self=this;var index=0;return{next:function(){var key=self._keys[index++];return{value:key!==undefined?self._values[key].v:undefined,done:key!==undefined?false:true}}}};Object.defineProperty(Map.prototype,"size",{enumerable:true,get:function(){return this._keys.length}});module.exports=Map;module.exports.Map=Map}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(require,module,exports){function MaxKey(){if(!(this instanceof MaxKey))return new MaxKey;this._bsontype="MaxKey"}module.exports=MaxKey;module.exports.MaxKey=MaxKey},{}],11:[function(require,module,exports){function MinKey(){if(!(this instanceof MinKey))return new MinKey;this._bsontype="MinKey"}module.exports=MinKey;module.exports.MinKey=MinKey},{}],12:[function(require,module,exports){(function(process,Buffer){var MACHINE_ID=parseInt(Math.random()*16777215,10);var checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$");var hasBufferType=false;try{if(Buffer&&Buffer.from)hasBufferType=true}catch(err){}var ObjectID=function ObjectID(id){if(id instanceof ObjectID)return id;if(!(this instanceof ObjectID))return new ObjectID(id);this._bsontype="ObjectID";if(id==null||typeof id=="number"){this.id=this.generate(id);if(ObjectID.cacheHexString)this.__id=this.toString("hex");return}var valid=ObjectID.isValid(id);if(!valid&&id!=null){throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}else if(valid&&typeof id=="string"&&id.length==24&&hasBufferType){return new ObjectID(new Buffer(id,"hex"))}else if(valid&&typeof id=="string"&&id.length==24){return ObjectID.createFromHexString(id)}else if(id!=null&&id.length===12){this.id=id}else if(id!=null&&id.toHexString){return id}else{throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}if(ObjectID.cacheHexString)this.__id=this.toString("hex")};var ObjectId=ObjectID;var hexTable=[];for(var i=0;i<256;i++){hexTable[i]=(i<=15?"0":"")+i.toString(16)}ObjectID.prototype.toHexString=function(){if(ObjectID.cacheHexString&&this.__id)return this.__id;var hexString="";if(!this.id||!this.id.length){throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]")}if(this.id instanceof _Buffer){hexString=convertToHex(this.id);if(ObjectID.cacheHexString)this.__id=hexString;return hexString}for(var i=0;i<this.id.length;i++){hexString+=hexTable[this.id.charCodeAt(i)]}if(ObjectID.cacheHexString)this.__id=hexString;return hexString};ObjectID.prototype.get_inc=function(){return ObjectID.index=(ObjectID.index+1)%16777215};ObjectID.prototype.getInc=function(){return this.get_inc()};ObjectID.prototype.generate=function(time){if("number"!=typeof time){time=~~(Date.now()/1e3)}var pid=(typeof process==="undefined"?Math.floor(Math.random()*1e5):process.pid)%65535;var inc=this.get_inc();var buffer=new Buffer(12);buffer[3]=time&255;buffer[2]=time>>8&255;buffer[1]=time>>16&255;buffer[0]=time>>24&255;buffer[6]=MACHINE_ID&255;buffer[5]=MACHINE_ID>>8&255;buffer[4]=MACHINE_ID>>16&255;buffer[8]=pid&255;buffer[7]=pid>>8&255;buffer[11]=inc&255;buffer[10]=inc>>8&255;buffer[9]=inc>>16&255;return buffer};ObjectID.prototype.toString=function(format){if(this.id&&this.id.copy){return this.id.toString(typeof format==="string"?format:"hex")}return this.toHexString()};ObjectID.prototype.inspect=ObjectID.prototype.toString;ObjectID.prototype.toJSON=function(){return this.toHexString()};ObjectID.prototype.equals=function equals(otherId){var id;if(otherId instanceof ObjectID){return this.toString()==otherId.toString()}else if(typeof otherId=="string"&&ObjectID.isValid(otherId)&&otherId.length==12&&this.id instanceof _Buffer){return otherId===this.id.toString("binary")}else if(typeof otherId=="string"&&ObjectID.isValid(otherId)&&otherId.length==24){return otherId.toLowerCase()===this.toHexString()}else if(typeof otherId=="string"&&ObjectID.isValid(otherId)&&otherId.length==12){return otherId===this.id}else if(otherId!=null&&(otherId instanceof ObjectID||otherId.toHexString)){return otherId.toHexString()===this.toHexString()}else{return false}};ObjectID.prototype.getTimestamp=function(){var timestamp=new Date;var time=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;timestamp.setTime(Math.floor(time)*1e3);return timestamp};ObjectID.index=~~(Math.random()*16777215);ObjectID.createPk=function createPk(){return new ObjectID};ObjectID.createFromTime=function createFromTime(time){var buffer=new Buffer([0,0,0,0,0,0,0,0,0,0,0,0]);buffer[3]=time&255;buffer[2]=time>>8&255;buffer[1]=time>>16&255;buffer[0]=time>>24&255;return new ObjectID(buffer)};var encodeLookup="0123456789abcdef".split("");var decodeLookup=[];var i=0;while(i<10)decodeLookup[48+i]=i++;while(i<16)decodeLookup[65-10+i]=decodeLookup[97-10+i]=i++;var _Buffer=Buffer;var convertToHex=function(bytes){return bytes.toString("hex")};ObjectID.createFromHexString=function createFromHexString(string){if(typeof string==="undefined"||string!=null&&string.length!=24){throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}if(hasBufferType)return new ObjectID(new Buffer(string,"hex"));var array=new _Buffer(12);var n=0;var i=0;while(i<24){array[n++]=decodeLookup[string.charCodeAt(i++)]<<4|decodeLookup[string.charCodeAt(i++)]}return new ObjectID(array)};ObjectID.isValid=function isValid(id){if(id==null)return false;if(typeof id=="number"){return true}if(typeof id=="string"){return id.length==12||id.length==24&&checkForHexRegExp.test(id)}if(id instanceof ObjectID){return true}if(id instanceof _Buffer){return true}if(id.toHexString){return id.id.length==12||id.id.length==24&&checkForHexRegExp.test(id.id)}return false};Object.defineProperty(ObjectID.prototype,"generationTime",{enumerable:true,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(value){this.id[3]=value&255;this.id[2]=value>>8&255;this.id[1]=value>>16&255;this.id[0]=value>>24&255}});module.exports=ObjectID;module.exports.ObjectID=ObjectID;module.exports.ObjectId=ObjectID}).call(this,require("_process"),require("buffer").Buffer)},{_process:30,buffer:28}],13:[function(require,module,exports){(function(Buffer){"use strict";var writeIEEE754=require("../float_parser").writeIEEE754,readIEEE754=require("../float_parser").readIEEE754,Long=require("../long").Long,Double=require("../double").Double,Timestamp=require("../timestamp").Timestamp,ObjectID=require("../objectid").ObjectID,Symbol=require("../symbol").Symbol,BSONRegExp=require("../regexp").BSONRegExp,Code=require("../code").Code,Decimal128=require("../decimal128"),MinKey=require("../min_key").MinKey,MaxKey=require("../max_key").MaxKey,DBRef=require("../db_ref").DBRef,Binary=require("../binary").Binary;var isDate=function isDate(d){return typeof d==="object"&&Object.prototype.toString.call(d)==="[object Date]"};var calculateObjectSize=function calculateObjectSize(object,serializeFunctions,ignoreUndefined){var totalLength=4+1;if(Array.isArray(object)){for(var i=0;i<object.length;i++){totalLength+=calculateElement(i.toString(),object[i],serializeFunctions,true,ignoreUndefined)}}else{if(object.toBSON){object=object.toBSON()}for(var key in object){totalLength+=calculateElement(key,object[key],serializeFunctions,false,ignoreUndefined)}}return totalLength};function calculateElement(name,value,serializeFunctions,isArray,ignoreUndefined){if(value&&value.toBSON){value=value.toBSON()}switch(typeof value){case"string":return 1+Buffer.byteLength(name,"utf8")+1+4+Buffer.byteLength(value,"utf8")+1;case"number":if(Math.floor(value)===value&&value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){if(value>=BSON.BSON_INT32_MIN&&value<=BSON.BSON_INT32_MAX){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(4+1)}else{return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(8+1)}}else{return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(8+1)}case"undefined":if(isArray||!ignoreUndefined)return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1;return 0;case"boolean":return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(1+1);case"object":if(value==null||value instanceof MinKey||value instanceof MaxKey||value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1}else if(value instanceof ObjectID||value["_bsontype"]=="ObjectID"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(12+1)}else if(value instanceof Date||isDate(value)){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(8+1)}else if(typeof Buffer!=="undefined"&&Buffer.isBuffer(value)){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(1+4+1)+value.length}else if(value instanceof Long||value instanceof Double||value instanceof Timestamp||value["_bsontype"]=="Long"||value["_bsontype"]=="Double"||value["_bsontype"]=="Timestamp"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(8+1)}else if(value instanceof Decimal128||value["_bsontype"]=="Decimal128"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(16+1)}else if(value instanceof Code||value["_bsontype"]=="Code"){if(value.scope!=null&&Object.keys(value.scope).length>0){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+4+4+Buffer.byteLength(value.code.toString(),"utf8")+1+calculateObjectSize(value.scope,serializeFunctions,ignoreUndefined)}else{return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+4+Buffer.byteLength(value.code.toString(),"utf8")+1}}else if(value instanceof Binary||value["_bsontype"]=="Binary"){if(value.sub_type==Binary.SUBTYPE_BYTE_ARRAY){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(value.position+1+4+1+4)}else{return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+(value.position+1+4+1)}}else if(value instanceof Symbol||value["_bsontype"]=="Symbol"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+Buffer.byteLength(value.value,"utf8")+4+1+1}else if(value instanceof DBRef||value["_bsontype"]=="DBRef"){var ordered_values={$ref:value.namespace,$id:value.oid};if(null!=value.db){ordered_values["$db"]=value.db}return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+calculateObjectSize(ordered_values,serializeFunctions,ignoreUndefined)}else if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+Buffer.byteLength(value.source,"utf8")+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1}else if(value instanceof BSONRegExp||value["_bsontype"]=="BSONRegExp"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+Buffer.byteLength(value.pattern,"utf8")+1+Buffer.byteLength(value.options,"utf8")+1}else{return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+calculateObjectSize(value,serializeFunctions,ignoreUndefined)+1}case"function":if(value instanceof RegExp||Object.prototype.toString.call(value)==="[object RegExp]"||String.call(value)=="[object RegExp]"){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+Buffer.byteLength(value.source,"utf8")+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1}else{if(serializeFunctions&&value.scope!=null&&Object.keys(value.scope).length>0){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+4+4+Buffer.byteLength(value.toString(),"utf8")+1+calculateObjectSize(value.scope,serializeFunctions,ignoreUndefined)}else if(serializeFunctions){return(name!=null?Buffer.byteLength(name,"utf8")+1:0)+1+4+Buffer.byteLength(value.toString(),"utf8")+1}}}return 0}var BSON={};BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;module.exports=calculateObjectSize}).call(this,require("buffer").Buffer)},{"../binary":1,"../code":2,"../db_ref":3,"../decimal128":4,"../double":5,"../float_parser":6,"../long":8,"../max_key":10,"../min_key":11,"../objectid":12,"../regexp":16,"../symbol":17,"../timestamp":18,buffer:28}],14:[function(require,module,exports){(function(Buffer){"use strict";var readIEEE754=require("../float_parser").readIEEE754,f=require("util").format,Long=require("../long").Long,Double=require("../double").Double,Timestamp=require("../timestamp").Timestamp,ObjectID=require("../objectid").ObjectID,Symbol=require("../symbol").Symbol,Code=require("../code").Code,MinKey=require("../min_key").MinKey,MaxKey=require("../max_key").MaxKey,Decimal128=require("../decimal128"),Int32=require("../int_32"),DBRef=require("../db_ref").DBRef,BSONRegExp=require("../regexp").BSONRegExp,Binary=require("../binary").Binary;var deserialize=function(buffer,options,isArray){options=options==null?{}:options;var index=options&&options.index?options.index:0;var size=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;if(size<5||buffer.length<size||size+index>buffer.length){throw new Error("corrupt bson message")}if(buffer[index+size-1]!=0){throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00")}return deserializeObject(buffer,index,options,isArray)};var deserializeObject=function(buffer,index,options,isArray){var evalFunctions=options["evalFunctions"]==null?false:options["evalFunctions"];var cacheFunctions=options["cacheFunctions"]==null?false:options["cacheFunctions"];var cacheFunctionsCrc32=options["cacheFunctionsCrc32"]==null?false:options["cacheFunctionsCrc32"];var fieldsAsRaw=options["fieldsAsRaw"]==null?null:options["fieldsAsRaw"];var raw=options["raw"]==null?false:options["raw"];var bsonRegExp=typeof options["bsonRegExp"]=="boolean"?options["bsonRegExp"]:false;var promoteBuffers=options["promoteBuffers"]==null?false:options["promoteBuffers"];var promoteLongs=options["promoteLongs"]==null?true:options["promoteLongs"];var promoteValues=options["promoteValues"]==null?true:options["promoteValues"];var startIndex=index;if(buffer.length<5)throw new Error("corrupt bson message < 5 bytes long");var size=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(size<5||size>buffer.length)throw new Error("corrupt bson message");var object=isArray?[]:{};var arrayIndex=0;while(true){var elementType=buffer[index++];if(elementType==0){break}var i=index;while(buffer[i]!==0&&i<buffer.length){i++}if(i>=buffer.length)throw new Error("Bad BSON Document: illegal CString");var name=isArray?arrayIndex++:buffer.toString("utf8",index,i);index=i+1;if(elementType==BSON.BSON_DATA_STRING){var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(stringSize<=0||stringSize>buffer.length-index||buffer[index+stringSize-1]!=0)throw new Error("bad string length in bson");object[name]=buffer.toString("utf8",index,index+stringSize-1);index=index+stringSize}else if(elementType==BSON.BSON_DATA_OID){var oid=new Buffer(12);buffer.copy(oid,0,index,index+12);object[name]=new ObjectID(oid);index=index+12}else if(elementType==BSON.BSON_DATA_INT&&promoteValues==false){object[name]=new Int32(buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24)}else if(elementType==BSON.BSON_DATA_INT){object[name]=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24}else if(elementType==BSON.BSON_DATA_NUMBER&&promoteValues==false){object[name]=new Double(buffer.readDoubleLE(index));index=index+8}else if(elementType==BSON.BSON_DATA_NUMBER){object[name]=buffer.readDoubleLE(index);index=index+8}else if(elementType==BSON.BSON_DATA_DATE){var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=new Date(new Long(lowBits,highBits).toNumber())}else if(elementType==BSON.BSON_DATA_BOOLEAN){if(buffer[index]!=0&&buffer[index]!=1)throw new Error("illegal boolean type value");object[name]=buffer[index++]==1}else if(elementType==BSON.BSON_DATA_OBJECT){var _index=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;if(objectSize<=0||objectSize>buffer.length-index)throw new Error("bad embedded document length in bson");if(raw){object[name]=buffer.slice(index,index+objectSize)}else{object[name]=deserializeObject(buffer,_index,options,false)}index=index+objectSize}else if(elementType==BSON.BSON_DATA_ARRAY){var _index=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;var arrayOptions=options;var stopIndex=index+objectSize;if(fieldsAsRaw&&fieldsAsRaw[name]){arrayOptions={};for(var n in options)arrayOptions[n]=options[n];arrayOptions["raw"]=true}object[name]=deserializeObject(buffer,_index,arrayOptions,true);index=index+objectSize;if(buffer[index-1]!=0)throw new Error("invalid array terminator byte");if(index!=stopIndex)throw new Error("corrupted array bson")}else if(elementType==BSON.BSON_DATA_UNDEFINED){object[name]=undefined}else if(elementType==BSON.BSON_DATA_NULL){object[name]=null}else if(elementType==BSON.BSON_DATA_LONG){var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var long=new Long(lowBits,highBits);if(promoteLongs&&promoteValues==true){object[name]=long.lessThanOrEqual(JS_INT_MAX_LONG)&&long.greaterThanOrEqual(JS_INT_MIN_LONG)?long.toNumber():long}else{object[name]=long}}else if(elementType==BSON.BSON_DATA_DECIMAL128){var bytes=new Buffer(16);buffer.copy(bytes,0,index,index+16);index=index+16;var decimal128=new Decimal128(bytes);object[name]=decimal128.toObject?decimal128.toObject():decimal128}else if(elementType==BSON.BSON_DATA_BINARY){var binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var totalBinarySize=binarySize;var subType=buffer[index++];if(binarySize<0)throw new Error("Negative binary type element size found");if(binarySize>buffer.length)throw new Error("Binary type size larger than document size");if(buffer["slice"]!=null){if(subType==Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(binarySize<0)throw new Error("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(binarySize<totalBinarySize-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}if(promoteBuffers&&promoteValues){object[name]=buffer.slice(index,index+binarySize)}else{object[name]=new Binary(buffer.slice(index,index+binarySize),subType)}}else{var _buffer=typeof Uint8Array!="undefined"?new Uint8Array(new ArrayBuffer(binarySize)):new Array(binarySize);if(subType==Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(binarySize<0)throw new Error("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(binarySize<totalBinarySize-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(var i=0;i<binarySize;i++){_buffer[i]=buffer[index+i]}if(promoteBuffers&&promoteValues){object[name]=_buffer}else{object[name]=new Binary(_buffer,subType)}}index=index+binarySize}else if(elementType==BSON.BSON_DATA_REGEXP&&bsonRegExp==false){var i=index;while(buffer[i]!==0&&i<buffer.length){i++}if(i>=buffer.length)throw new Error("Bad BSON Document: illegal CString");var source=buffer.toString("utf8",index,i);index=i+1;var i=index;while(buffer[i]!==0&&i<buffer.length){i++}if(i>=buffer.length)throw new Error("Bad BSON Document: illegal CString");var regExpOptions=buffer.toString("utf8",index,i);index=i+1;var optionsArray=new Array(regExpOptions.length);for(var i=0;i<regExpOptions.length;i++){switch(regExpOptions[i]){case"m":optionsArray[i]="m";break;case"s":optionsArray[i]="g";break;case"i":optionsArray[i]="i";break}}object[name]=new RegExp(source,optionsArray.join(""))}else if(elementType==BSON.BSON_DATA_REGEXP&&bsonRegExp==true){var i=index;while(buffer[i]!==0&&i<buffer.length){i++}if(i>=buffer.length)throw new Error("Bad BSON Document: illegal CString");var source=buffer.toString("utf8",index,i);index=i+1;var i=index;while(buffer[i]!==0&&i<buffer.length){i++}if(i>=buffer.length)throw new Error("Bad BSON Document: illegal CString");var regExpOptions=buffer.toString("utf8",index,i);index=i+1;object[name]=new BSONRegExp(source,regExpOptions)}else if(elementType==BSON.BSON_DATA_SYMBOL){var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(stringSize<=0||stringSize>buffer.length-index||buffer[index+stringSize-1]!=0)throw new Error("bad string length in bson");object[name]=new Symbol(buffer.toString("utf8",index,index+stringSize-1));index=index+stringSize}else if(elementType==BSON.BSON_DATA_TIMESTAMP){var lowBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;var highBits=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;object[name]=new Timestamp(lowBits,highBits)}else if(elementType==BSON.BSON_DATA_MIN_KEY){object[name]=new MinKey}else if(elementType==BSON.BSON_DATA_MAX_KEY){object[name]=new MaxKey}else if(elementType==BSON.BSON_DATA_CODE){var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(stringSize<=0||stringSize>buffer.length-index||buffer[index+stringSize-1]!=0)throw new Error("bad string length in bson");var functionString=buffer.toString("utf8",index,index+stringSize-1);if(evalFunctions){var value=null;if(cacheFunctions){var hash=cacheFunctionsCrc32?crc32(functionString):functionString;object[name]=isolateEvalWithHash(functionCache,hash,functionString,object)}else{object[name]=isolateEval(functionString)}}else{object[name]=new Code(functionString)}index=index+stringSize}else if(elementType==BSON.BSON_DATA_CODE_W_SCOPE){var totalSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(totalSize<4+4+4+1){throw new Error("code_w_scope total size shorter minimum expected length")}var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(stringSize<=0||stringSize>buffer.length-index||buffer[index+stringSize-1]!=0)throw new Error("bad string length in bson");var functionString=buffer.toString("utf8",index,index+stringSize-1);index=index+stringSize;var _index=index;var objectSize=buffer[index]|buffer[index+1]<<8|buffer[index+2]<<16|buffer[index+3]<<24;var scopeObject=deserializeObject(buffer,_index,options,false);index=index+objectSize;if(totalSize<4+4+objectSize+stringSize){
throw new Error("code_w_scope total size is to short, truncating scope")}if(totalSize>4+4+objectSize+stringSize){throw new Error("code_w_scope total size is to long, clips outer document")}if(evalFunctions){var value=null;if(cacheFunctions){var hash=cacheFunctionsCrc32?crc32(functionString):functionString;object[name]=isolateEvalWithHash(functionCache,hash,functionString,object)}else{object[name]=isolateEval(functionString)}object[name].scope=scopeObject}else{object[name]=new Code(functionString,scopeObject)}}else if(elementType==BSON.BSON_DATA_DBPOINTER){var stringSize=buffer[index++]|buffer[index++]<<8|buffer[index++]<<16|buffer[index++]<<24;if(stringSize<=0||stringSize>buffer.length-index||buffer[index+stringSize-1]!=0)throw new Error("bad string length in bson");var namespace=buffer.toString("utf8",index,index+stringSize-1);index=index+stringSize;var oidBuffer=new Buffer(12);buffer.copy(oidBuffer,0,index,index+12);var oid=new ObjectID(oidBuffer);index=index+12;var parts=namespace.split(".");var db=parts.shift();var collection=parts.join(".");object[name]=new DBRef(collection,oid,db)}else{throw new Error("Detected unknown BSON type "+elementType.toString(16)+' for fieldname "'+name+'", are you using the latest BSON parser')}}if(size!=index-startIndex){if(isArray)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}if(object["$id"]!=null)object=new DBRef(object["$ref"],object["$id"],object["$db"]);return object};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;if(functionCache[hash]==null){eval("value = "+functionString);functionCache[hash]=value}return functionCache[hash].bind(object)};var isolateEval=function(functionString){var value=null;eval("value = "+functionString);return value};var BSON={};var functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_UNDEFINED=6;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_DBPOINTER=12;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_DECIMAL128=19;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992);var JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize}).call(this,require("buffer").Buffer)},{"../binary":1,"../code":2,"../db_ref":3,"../decimal128":4,"../double":5,"../float_parser":6,"../int_32":7,"../long":8,"../max_key":10,"../min_key":11,"../objectid":12,"../regexp":16,"../symbol":17,"../timestamp":18,buffer:28,util:33}],15:[function(require,module,exports){(function(Buffer){"use strict";var writeIEEE754=require("../float_parser").writeIEEE754,readIEEE754=require("../float_parser").readIEEE754,Long=require("../long").Long,Map=require("../map"),Double=require("../double").Double,Timestamp=require("../timestamp").Timestamp,ObjectID=require("../objectid").ObjectID,Symbol=require("../symbol").Symbol,Code=require("../code").Code,BSONRegExp=require("../regexp").BSONRegExp,Int32=require("../int_32").Int32,MinKey=require("../min_key").MinKey,MaxKey=require("../max_key").MaxKey,Decimal128=require("../decimal128"),DBRef=require("../db_ref").DBRef,Binary=require("../binary").Binary;try{var _Buffer=Uint8Array}catch(e){var _Buffer=Buffer}var regexp=/\x00/;var isDate=function isDate(d){return typeof d==="object"&&Object.prototype.toString.call(d)==="[object Date]"};var isRegExp=function isRegExp(d){return Object.prototype.toString.call(d)==="[object RegExp]"};var serializeString=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_STRING;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes+1;buffer[index-1]=0;var size=buffer.write(value,index+4,"utf8");buffer[index+3]=size+1>>24&255;buffer[index+2]=size+1>>16&255;buffer[index+1]=size+1>>8&255;buffer[index]=size+1&255;index=index+4+size;buffer[index++]=0;return index};var serializeNumber=function(buffer,key,value,index,isArray){if(Math.floor(value)===value&&value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){if(value>=BSON.BSON_INT32_MIN&&value<=BSON.BSON_INT32_MAX){buffer[index++]=BSON.BSON_DATA_INT;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;buffer[index++]=value&255;buffer[index++]=value>>8&255;buffer[index++]=value>>16&255;buffer[index++]=value>>24&255}else if(value>=BSON.JS_INT_MIN&&value<=BSON.JS_INT_MAX){buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8}else{buffer[index++]=BSON.BSON_DATA_LONG;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var longVal=Long.fromNumber(value);var lowBits=longVal.getLowBits();var highBits=longVal.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255}}else{buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8}return index};var serializeNull=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_NULL;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;return index};var serializeBoolean=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_BOOLEAN;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;buffer[index++]=value?1:0;return index};var serializeDate=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_DATE;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var dateInMilis=Long.fromNumber(value.getTime());var lowBits=dateInMilis.getLowBits();var highBits=dateInMilis.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255;return index};var serializeRegExp=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_REGEXP;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;if(value.source&&value.source.match(regexp)!=null){throw Error("value "+value.source+" must not contain null bytes")}index=index+buffer.write(value.source,index,"utf8");buffer[index++]=0;if(value.global)buffer[index++]=115;if(value.ignoreCase)buffer[index++]=105;if(value.multiline)buffer[index++]=109;buffer[index++]=0;return index};var serializeBSONRegExp=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_REGEXP;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;if(value.pattern.match(regexp)!=null){throw Error("pattern "+value.pattern+" must not contain null bytes")}index=index+buffer.write(value.pattern,index,"utf8");buffer[index++]=0;index=index+buffer.write(value.options.split("").sort().join(""),index,"utf8");buffer[index++]=0;return index};var serializeMinMax=function(buffer,key,value,index,isArray){if(value===null){buffer[index++]=BSON.BSON_DATA_NULL}else if(value instanceof MinKey){buffer[index++]=BSON.BSON_DATA_MIN_KEY}else{buffer[index++]=BSON.BSON_DATA_MAX_KEY}var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;return index};var serializeObjectId=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_OID;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;if(typeof value.id=="string"){buffer.write(value.id,index,"binary")}else if(value.id&&value.id.copy){value.id.copy(buffer,index,0,12)}else{throw new Error("object ["+JSON.stringify(value)+"] is not a valid ObjectId")}return index+12};var serializeBuffer=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_BINARY;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var size=value.length;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer[index++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT;value.copy(buffer,index,0,size);index=index+size;return index};var serializeObject=function(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,isArray,path){for(var i=0;i<path.length;i++){if(path[i]===value)throw new Error("cyclic dependency detected")}path.push(value);buffer[index++]=Array.isArray(value)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var endIndex=serializeInto(buffer,value,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined,path);path.pop();var size=endIndex-index;return endIndex};var serializeDecimal128=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_DECIMAL128;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;value.bytes.copy(buffer,index,0,16);return index+16};var serializeLong=function(buffer,key,value,index,isArray){buffer[index++]=value._bsontype=="Long"?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var lowBits=value.getLowBits();var highBits=value.getHighBits();buffer[index++]=lowBits&255;buffer[index++]=lowBits>>8&255;buffer[index++]=lowBits>>16&255;buffer[index++]=lowBits>>24&255;buffer[index++]=highBits&255;buffer[index++]=highBits>>8&255;buffer[index++]=highBits>>16&255;buffer[index++]=highBits>>24&255;return index};var serializeInt32=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_INT;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;buffer[index++]=value&255;buffer[index++]=value>>8&255;buffer[index++]=value>>16&255;buffer[index++]=value>>24&255;return index};var serializeDouble=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_NUMBER;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;writeIEEE754(buffer,value,index,"little",52,8);index=index+8;return index};var serializeFunction=function(buffer,key,value,index,checkKeys,depth,isArray){buffer[index++]=BSON.BSON_DATA_CODE;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var functionString=value.toString();var size=buffer.write(functionString,index+4,"utf8")+1;buffer[index]=size&255;buffer[index+1]=size>>8&255;buffer[index+2]=size>>16&255;buffer[index+3]=size>>24&255;index=index+4+size-1;buffer[index++]=0;return index};var serializeCode=function(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,isArray){if(value.scope&&typeof value.scope=="object"){buffer[index++]=BSON.BSON_DATA_CODE_W_SCOPE;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var startIndex=index;var functionString=typeof value.code=="string"?value.code:value.code.toString();index=index+4;var codeSize=buffer.write(functionString,index+4,"utf8")+1;buffer[index]=codeSize&255;buffer[index+1]=codeSize>>8&255;buffer[index+2]=codeSize>>16&255;buffer[index+3]=codeSize>>24&255;buffer[index+4+codeSize-1]=0;index=index+codeSize+4;var endIndex=serializeInto(buffer,value.scope,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined);index=endIndex-1;var totalSize=endIndex-startIndex;buffer[startIndex++]=totalSize&255;buffer[startIndex++]=totalSize>>8&255;buffer[startIndex++]=totalSize>>16&255;buffer[startIndex++]=totalSize>>24&255;buffer[index++]=0}else{buffer[index++]=BSON.BSON_DATA_CODE;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var functionString=value.code.toString();var size=buffer.write(functionString,index+4,"utf8")+1;buffer[index]=size&255;buffer[index+1]=size>>8&255;buffer[index+2]=size>>16&255;buffer[index+3]=size>>24&255;index=index+4+size-1;buffer[index++]=0}return index};var serializeBinary=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_BINARY;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var data=value.value(true);var size=value.position;if(value.sub_type==Binary.SUBTYPE_BYTE_ARRAY)size=size+4;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255;buffer[index++]=value.sub_type;if(value.sub_type==Binary.SUBTYPE_BYTE_ARRAY){size=size-4;buffer[index++]=size&255;buffer[index++]=size>>8&255;buffer[index++]=size>>16&255;buffer[index++]=size>>24&255}data.copy(buffer,index,0,value.position);index=index+value.position;return index};var serializeSymbol=function(buffer,key,value,index,isArray){buffer[index++]=BSON.BSON_DATA_SYMBOL;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var size=buffer.write(value.value,index+4,"utf8")+1;buffer[index]=size&255;buffer[index+1]=size>>8&255;buffer[index+2]=size>>16&255;buffer[index+3]=size>>24&255;index=index+4+size-1;buffer[index++]=0;return index};var serializeDBRef=function(buffer,key,value,index,depth,serializeFunctions,isArray){buffer[index++]=BSON.BSON_DATA_OBJECT;var numberOfWrittenBytes=!isArray?buffer.write(key,index,"utf8"):buffer.write(key,index,"ascii");index=index+numberOfWrittenBytes;buffer[index++]=0;var startIndex=index;var endIndex;if(null!=value.db){endIndex=serializeInto(buffer,{$ref:value.namespace,$id:value.oid,$db:value.db},false,index,depth+1,serializeFunctions)}else{endIndex=serializeInto(buffer,{$ref:value.namespace,$id:value.oid},false,index,depth+1,serializeFunctions)}var size=endIndex-startIndex;buffer[startIndex++]=size&255;buffer[startIndex++]=size>>8&255;buffer[startIndex++]=size>>16&255;buffer[startIndex++]=size>>24&255;return endIndex};var serializeInto=function serializeInto(buffer,object,checkKeys,startingIndex,depth,serializeFunctions,ignoreUndefined,path){startingIndex=startingIndex||0;path=path||[];path.push(object);var index=startingIndex+4;var self=this;if(Array.isArray(object)){for(var i=0;i<object.length;i++){var key=""+i;var value=object[i];if(value&&value.toBSON){if(typeof value.toBSON!="function")throw new Error("toBSON is not a function");value=value.toBSON()}var type=typeof value;if(type=="string"){index=serializeString(buffer,key,value,index,true)}else if(type=="number"){index=serializeNumber(buffer,key,value,index,true)}else if(type=="boolean"){index=serializeBoolean(buffer,key,value,index,true)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer,key,value,index,true)}else if(value===undefined){index=serializeNull(buffer,key,value,index,true)}else if(value===null){index=serializeNull(buffer,key,value,index,true)}else if(value["_bsontype"]=="ObjectID"){index=serializeObjectId(buffer,key,value,index,true)}else if(Buffer.isBuffer(value)){index=serializeBuffer(buffer,key,value,index,true)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer,key,value,index,true)}else if(type=="object"&&value["_bsontype"]==null){index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,true,path)}else if(type=="object"&&value["_bsontype"]=="Decimal128"){index=serializeDecimal128(buffer,key,value,index,true)}else if(value["_bsontype"]=="Long"||value["_bsontype"]=="Timestamp"){index=serializeLong(buffer,key,value,index,true)}else if(value["_bsontype"]=="Double"){index=serializeDouble(buffer,key,value,index,true)}else if(typeof value=="function"&&serializeFunctions){index=serializeFunction(buffer,key,value,index,checkKeys,depth,serializeFunctions,true)}else if(value["_bsontype"]=="Code"){index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,true)}else if(value["_bsontype"]=="Binary"){index=serializeBinary(buffer,key,value,index,true)}else if(value["_bsontype"]=="Symbol"){index=serializeSymbol(buffer,key,value,index,true)}else if(value["_bsontype"]=="DBRef"){index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions,true)}else if(value["_bsontype"]=="BSONRegExp"){index=serializeBSONRegExp(buffer,key,value,index,true)}else if(value["_bsontype"]=="Int32"){index=serializeInt32(buffer,key,value,index,true)}else if(value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){index=serializeMinMax(buffer,key,value,index,true)}}}else if(object instanceof Map){var iterator=object.entries();var done=false;while(!done){var entry=iterator.next();done=entry.done;if(done)continue;var key=entry.value[0];var value=entry.value[1];var type=typeof value;if(key!="$db"&&key!="$ref"&&key!="$id"){if(key.match(regexp)!=null){throw Error("key "+key+" must not contain null bytes")}if(checkKeys){if("$"==key[0]){throw Error("key "+key+" must not start with '$'")}else if(!!~key.indexOf(".")){throw Error("key "+key+" must not contain '.'")}}}if(type=="string"){index=serializeString(buffer,key,value,index)}else if(type=="number"){index=serializeNumber(buffer,key,value,index)}else if(type=="boolean"){index=serializeBoolean(buffer,key,value,index)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer,key,value,index)}else if(value===undefined&&ignoreUndefined==true){}else if(value===null||value===undefined){index=serializeNull(buffer,key,value,index)}else if(value["_bsontype"]=="ObjectID"){index=serializeObjectId(buffer,key,value,index)}else if(Buffer.isBuffer(value)){index=serializeBuffer(buffer,key,value,index)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer,key,value,index)}else if(type=="object"&&value["_bsontype"]==null){index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,false,path)}else if(type=="object"&&value["_bsontype"]=="Decimal128"){index=serializeDecimal128(buffer,key,value,index)}else if(value["_bsontype"]=="Long"||value["_bsontype"]=="Timestamp"){index=serializeLong(buffer,key,value,index)}else if(value["_bsontype"]=="Double"){index=serializeDouble(buffer,key,value,index)}else if(value["_bsontype"]=="Code"){index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined)}else if(typeof value=="function"&&serializeFunctions){index=serializeFunction(buffer,key,value,index,checkKeys,depth,serializeFunctions)}else if(value["_bsontype"]=="Binary"){index=serializeBinary(buffer,key,value,index)}else if(value["_bsontype"]=="Symbol"){index=serializeSymbol(buffer,key,value,index)}else if(value["_bsontype"]=="DBRef"){index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions)}else if(value["_bsontype"]=="BSONRegExp"){index=serializeBSONRegExp(buffer,key,value,index)}else if(value["_bsontype"]=="Int32"){index=serializeInt32(buffer,key,value,index)}else if(value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){index=serializeMinMax(buffer,key,value,index)}}}else{if(object.toBSON){if(typeof object.toBSON!="function")throw new Error("toBSON is not a function");object=object.toBSON();if(object!=null&&typeof object!="object")throw new Error("toBSON function did not return an object")}for(var key in object){var value=object[key];if(value&&value.toBSON){if(typeof value.toBSON!="function")throw new Error("toBSON is not a function");value=value.toBSON()}var type=typeof value;if(key!="$db"&&key!="$ref"&&key!="$id"){if(key.match(regexp)!=null){throw Error("key "+key+" must not contain null bytes")}if(checkKeys){if("$"==key[0]){throw Error("key "+key+" must not start with '$'")}else if(!!~key.indexOf(".")){throw Error("key "+key+" must not contain '.'")}}}if(type=="string"){index=serializeString(buffer,key,value,index)}else if(type=="number"){index=serializeNumber(buffer,key,value,index)}else if(type=="boolean"){index=serializeBoolean(buffer,key,value,index)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer,key,value,index)}else if(value===undefined&&ignoreUndefined==true){}else if(value===null||value===undefined){index=serializeNull(buffer,key,value,index)}else if(value["_bsontype"]=="ObjectID"){index=serializeObjectId(buffer,key,value,index)}else if(Buffer.isBuffer(value)){index=serializeBuffer(buffer,key,value,index)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer,key,value,index)}else if(type=="object"&&value["_bsontype"]==null){index=serializeObject(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,false,path)}else if(type=="object"&&value["_bsontype"]=="Decimal128"){index=serializeDecimal128(buffer,key,value,index)}else if(value["_bsontype"]=="Long"||value["_bsontype"]=="Timestamp"){index=serializeLong(buffer,key,value,index)}else if(value["_bsontype"]=="Double"){index=serializeDouble(buffer,key,value,index)}else if(value["_bsontype"]=="Code"){index=serializeCode(buffer,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined)}else if(typeof value=="function"&&serializeFunctions){index=serializeFunction(buffer,key,value,index,checkKeys,depth,serializeFunctions)}else if(value["_bsontype"]=="Binary"){index=serializeBinary(buffer,key,value,index)}else if(value["_bsontype"]=="Symbol"){index=serializeSymbol(buffer,key,value,index)}else if(value["_bsontype"]=="DBRef"){index=serializeDBRef(buffer,key,value,index,depth,serializeFunctions)}else if(value["_bsontype"]=="BSONRegExp"){index=serializeBSONRegExp(buffer,key,value,index)}else if(value["_bsontype"]=="Int32"){index=serializeInt32(buffer,key,value,index)}else if(value["_bsontype"]=="MinKey"||value["_bsontype"]=="MaxKey"){index=serializeMinMax(buffer,key,value,index)}}}path.pop();buffer[index++]=0;var size=index-startingIndex;buffer[startingIndex++]=size&255;buffer[startingIndex++]=size>>8&255;buffer[startingIndex++]=size>>16&255;buffer[startingIndex++]=size>>24&255;return index};var BSON={};var functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_UNDEFINED=6;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_DECIMAL128=19;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992);var JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=serializeInto}).call(this,require("buffer").Buffer)},{"../binary":1,"../code":2,"../db_ref":3,"../decimal128":4,"../double":5,"../float_parser":6,"../int_32":7,"../long":8,"../map":9,"../max_key":10,"../min_key":11,"../objectid":12,"../regexp":16,"../symbol":17,"../timestamp":18,buffer:28}],16:[function(require,module,exports){function BSONRegExp(pattern,options){if(!(this instanceof BSONRegExp))return new BSONRegExp;this._bsontype="BSONRegExp";this.pattern=pattern||"";this.options=options||"";for(var i=0;i<this.options.length;i++){if(!(this.options[i]=="i"||this.options[i]=="m"||this.options[i]=="x"||this.options[i]=="l"||this.options[i]=="s"||this.options[i]=="u")){throw new Error("the regular expression options ["+this.options[i]+"] is not supported")}}}module.exports=BSONRegExp;module.exports.BSONRegExp=BSONRegExp},{}],17:[function(require,module,exports){function Symbol(value){if(!(this instanceof Symbol))return new Symbol(value);this._bsontype="Symbol";this.value=value}Symbol.prototype.valueOf=function(){return this.value};Symbol.prototype.toString=function(){return this.value};Symbol.prototype.inspect=function(){return this.value};Symbol.prototype.toJSON=function(){return this.value};module.exports=Symbol;module.exports.Symbol=Symbol},{}],18:[function(require,module,exports){function Timestamp(low,high){if(!(this instanceof Timestamp))return new Timestamp(low,high);this._bsontype="Timestamp";this.low_=low|0;this.high_=high|0}Timestamp.prototype.toInt=function(){return this.low_};Timestamp.prototype.toNumber=function(){return this.high_*Timestamp.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Timestamp.prototype.toJSON=function(){return this.toString()};Timestamp.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){var radixTimestamp=Timestamp.fromNumber(radix);var div=this.div(radixTimestamp);var rem=div.multiply(radixTimestamp).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=Timestamp.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}};Timestamp.prototype.getHighBits=function(){return this.high_};Timestamp.prototype.getLowBits=function(){return this.low_};Timestamp.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Timestamp.TWO_PWR_32_DBL_+this.low_};Timestamp.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}};Timestamp.prototype.isZero=function(){return this.high_==0&&this.low_==0};Timestamp.prototype.isNegative=function(){return this.high_<0};Timestamp.prototype.isOdd=function(){return(this.low_&1)==1};Timestamp.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_};Timestamp.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_};Timestamp.prototype.lessThan=function(other){return this.compare(other)<0};Timestamp.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0};Timestamp.prototype.greaterThan=function(other){return this.compare(other)>0};Timestamp.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0};Timestamp.prototype.compare=function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}};Timestamp.prototype.negate=function(){if(this.equals(Timestamp.MIN_VALUE)){return Timestamp.MIN_VALUE}else{return this.not().add(Timestamp.ONE)}};Timestamp.prototype.add=function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Timestamp.fromBits(c16<<16|c00,c48<<16|c32)};Timestamp.prototype.subtract=function(other){return this.add(other.negate())};Timestamp.prototype.multiply=function(other){if(this.isZero()){return Timestamp.ZERO}else if(other.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){return other.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}else if(other.equals(Timestamp.MIN_VALUE)){return this.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(Timestamp.TWO_PWR_24_)&&other.lessThan(Timestamp.TWO_PWR_24_)){return Timestamp.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Timestamp.fromBits(c16<<16|c00,c48<<16|c32)};Timestamp.prototype.div=function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){if(other.equals(Timestamp.ONE)||other.equals(Timestamp.NEG_ONE)){return Timestamp.MIN_VALUE}else if(other.equals(Timestamp.MIN_VALUE)){return Timestamp.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(Timestamp.ZERO)){return other.isNegative()?Timestamp.ONE:Timestamp.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(Timestamp.MIN_VALUE)){return Timestamp.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=Timestamp.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){
var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=Timestamp.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=Timestamp.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=Timestamp.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res};Timestamp.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))};Timestamp.prototype.not=function(){return Timestamp.fromBits(~this.low_,~this.high_)};Timestamp.prototype.and=function(other){return Timestamp.fromBits(this.low_&other.low_,this.high_&other.high_)};Timestamp.prototype.or=function(other){return Timestamp.fromBits(this.low_|other.low_,this.high_|other.high_)};Timestamp.prototype.xor=function(other){return Timestamp.fromBits(this.low_^other.low_,this.high_^other.high_)};Timestamp.prototype.shiftLeft=function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return Timestamp.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return Timestamp.fromBits(0,low<<numBits-32)}}};Timestamp.prototype.shiftRight=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Timestamp.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return Timestamp.fromBits(high>>numBits-32,high>=0?0:-1)}}};Timestamp.prototype.shiftRightUnsigned=function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return Timestamp.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return Timestamp.fromBits(high,0)}else{return Timestamp.fromBits(high>>>numBits-32,0)}}};Timestamp.fromInt=function(value){if(-128<=value&&value<128){var cachedObj=Timestamp.INT_CACHE_[value];if(cachedObj){return cachedObj}}var obj=new Timestamp(value|0,value<0?-1:0);if(-128<=value&&value<128){Timestamp.INT_CACHE_[value]=obj}return obj};Timestamp.fromNumber=function(value){if(isNaN(value)||!isFinite(value)){return Timestamp.ZERO}else if(value<=-Timestamp.TWO_PWR_63_DBL_){return Timestamp.MIN_VALUE}else if(value+1>=Timestamp.TWO_PWR_63_DBL_){return Timestamp.MAX_VALUE}else if(value<0){return Timestamp.fromNumber(-value).negate()}else{return new Timestamp(value%Timestamp.TWO_PWR_32_DBL_|0,value/Timestamp.TWO_PWR_32_DBL_|0)}};Timestamp.fromBits=function(lowBits,highBits){return new Timestamp(lowBits,highBits)};Timestamp.fromString=function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return Timestamp.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=Timestamp.fromNumber(Math.pow(radix,8));var result=Timestamp.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Timestamp.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(Timestamp.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(Timestamp.fromNumber(value))}}return result};Timestamp.INT_CACHE_={};Timestamp.TWO_PWR_16_DBL_=1<<16;Timestamp.TWO_PWR_24_DBL_=1<<24;Timestamp.TWO_PWR_32_DBL_=Timestamp.TWO_PWR_16_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_31_DBL_=Timestamp.TWO_PWR_32_DBL_/2;Timestamp.TWO_PWR_48_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_64_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_32_DBL_;Timestamp.TWO_PWR_63_DBL_=Timestamp.TWO_PWR_64_DBL_/2;Timestamp.ZERO=Timestamp.fromInt(0);Timestamp.ONE=Timestamp.fromInt(1);Timestamp.NEG_ONE=Timestamp.fromInt(-1);Timestamp.MAX_VALUE=Timestamp.fromBits(4294967295|0,2147483647|0);Timestamp.MIN_VALUE=Timestamp.fromBits(0,2147483648|0);Timestamp.TWO_PWR_24_=Timestamp.fromInt(1<<24);module.exports=Timestamp;module.exports.Timestamp=Timestamp},{}],19:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],20:[function(require,module,exports){(function(Buffer){function Hash(blockSize,finalSize){this._block=new Buffer(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0;this._s=0}Hash.prototype.update=function(data,enc){if(typeof data==="string"){enc=enc||"utf8";data=new Buffer(data,enc)}var l=this._len+=data.length;var s=this._s||0;var f=0;var buffer=this._block;while(s<l){var t=Math.min(data.length,f+this._blockSize-s%this._blockSize);var ch=t-f;for(var i=0;i<ch;i++){buffer[s%this._blockSize+i]=data[i+f]}s+=ch;f+=ch;if(s%this._blockSize===0){this._update(buffer)}}this._s=s;return this};Hash.prototype.digest=function(enc){var l=this._len*8;this._block[this._len%this._blockSize]=128;this._block.fill(0,this._len%this._blockSize+1);if(l%(this._blockSize*8)>=this._finalSize*8){this._update(this._block);this._block.fill(0)}this._block.writeInt32BE(l,this._blockSize-4);var hash=this._update(this._block)||this._hash();return enc?hash.toString(enc):hash};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};module.exports=Hash}).call(this,require("buffer").Buffer)},{buffer:28}],21:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha,Hash);Sha.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;if(s===2)return b&c|b&d|c&d;return b^c^d}Sha.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=W[i-3]^W[i-8]^W[i-14]^W[i-16];for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha}).call(this,require("buffer").Buffer)},{"./hash":20,buffer:28,inherits:19}],22:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha1(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha1,Hash);Sha1.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl1(num){return num<<1|num>>>31}function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;if(s===2)return b&c|b&d|c&d;return b^c^d}Sha1.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=rotl1(W[i-3]^W[i-8]^W[i-14]^W[i-16]);for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha1.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha1}).call(this,require("buffer").Buffer)},{"./hash":20,buffer:28,inherits:19}],23:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Sha256=require("./sha256");var Hash=require("./hash");var W=new Array(64);function Sha224(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha224,Sha256);Sha224.prototype.init=function(){this._a=3238371032;this._b=914150663;this._c=812702999;this._d=4144912697;this._e=4290775857;this._f=1750603025;this._g=1694076839;this._h=3204075428;return this};Sha224.prototype._hash=function(){var H=new Buffer(28);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);return H};module.exports=Sha224}).call(this,require("buffer").Buffer)},{"./hash":20,"./sha256":24,buffer:28,inherits:19}],24:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var W=new Array(64);function Sha256(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha256,Hash);Sha256.prototype.init=function(){this._a=1779033703;this._b=3144134277;this._c=1013904242;this._d=2773480762;this._e=1359893119;this._f=2600822924;this._g=528734635;this._h=1541459225;return this};function ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function gamma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}function gamma1(x){return(x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10}Sha256.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<64;++i)W[i]=gamma1(W[i-2])+W[i-7]+gamma0(W[i-15])+W[i-16]|0;for(var j=0;j<64;++j){var T1=h+sigma1(e)+ch(e,f,g)+K[j]+W[j]|0;var T2=sigma0(a)+maj(a,b,c)|0;h=g;g=f;f=e;e=d+T1|0;d=c;c=b;b=a;a=T1+T2|0}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){var H=new Buffer(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};module.exports=Sha256}).call(this,require("buffer").Buffer)},{"./hash":20,buffer:28,inherits:19}],25:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var SHA512=require("./sha512");var Hash=require("./hash");var W=new Array(160);function Sha384(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){this._ah=3418070365;this._bh=1654270250;this._ch=2438529370;this._dh=355462360;this._eh=1731405415;this._fh=2394180231;this._gh=3675008525;this._hh=1203062813;this._al=3238371032;this._bl=914150663;this._cl=812702999;this._dl=4144912697;this._el=4290775857;this._fl=1750603025;this._gl=1694076839;this._hl=3204075428;return this};Sha384.prototype._hash=function(){var H=new Buffer(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);return H};module.exports=Sha384}).call(this,require("buffer").Buffer)},{"./hash":20,"./sha512":26,buffer:28,inherits:19}],26:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var W=new Array(160);function Sha512(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha512,Hash);Sha512.prototype.init=function(){this._ah=1779033703;this._bh=3144134277;this._ch=1013904242;this._dh=2773480762;this._eh=1359893119;this._fh=2600822924;this._gh=528734635;this._hh=1541459225;this._al=4089235720;this._bl=2227873595;this._cl=4271175723;this._dl=1595750129;this._el=2917565137;this._fl=725511199;this._gl=4215389547;this._hl=327033209;return this};function Ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x,xl){return(x>>>28|xl<<4)^(xl>>>2|x<<30)^(xl>>>7|x<<25)}function sigma1(x,xl){return(x>>>14|xl<<18)^(x>>>18|xl<<14)^(xl>>>9|x<<23)}function Gamma0(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^x>>>7}function Gamma0l(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7|xl<<25)}function Gamma1(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^x>>>6}function Gamma1l(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6|xl<<26)}function getCarry(a,b){return a>>>0<b>>>0?1:0}Sha512.prototype._update=function(M){var W=this._w;var ah=this._ah|0;var bh=this._bh|0;var ch=this._ch|0;var dh=this._dh|0;var eh=this._eh|0;var fh=this._fh|0;var gh=this._gh|0;var hh=this._hh|0;var al=this._al|0;var bl=this._bl|0;var cl=this._cl|0;var dl=this._dl|0;var el=this._el|0;var fl=this._fl|0;var gl=this._gl|0;var hl=this._hl|0;for(var i=0;i<32;i+=2){W[i]=M.readInt32BE(i*4);W[i+1]=M.readInt32BE(i*4+4)}for(;i<160;i+=2){var xh=W[i-15*2];var xl=W[i-15*2+1];var gamma0=Gamma0(xh,xl);var gamma0l=Gamma0l(xl,xh);xh=W[i-2*2];xl=W[i-2*2+1];var gamma1=Gamma1(xh,xl);var gamma1l=Gamma1l(xl,xh);var Wi7h=W[i-7*2];var Wi7l=W[i-7*2+1];var Wi16h=W[i-16*2];var Wi16l=W[i-16*2+1];var Wil=gamma0l+Wi7l|0;var Wih=gamma0+Wi7h+getCarry(Wil,gamma0l)|0;Wil=Wil+gamma1l|0;Wih=Wih+gamma1+getCarry(Wil,gamma1l)|0;Wil=Wil+Wi16l|0;Wih=Wih+Wi16h+getCarry(Wil,Wi16l)|0;W[i]=Wih;W[i+1]=Wil}for(var j=0;j<160;j+=2){Wih=W[j];Wil=W[j+1];var majh=maj(ah,bh,ch);var majl=maj(al,bl,cl);var sigma0h=sigma0(ah,al);var sigma0l=sigma0(al,ah);var sigma1h=sigma1(eh,el);var sigma1l=sigma1(el,eh);var Kih=K[j];var Kil=K[j+1];var chh=Ch(eh,fh,gh);var chl=Ch(el,fl,gl);var t1l=hl+sigma1l|0;var t1h=hh+sigma1h+getCarry(t1l,hl)|0;t1l=t1l+chl|0;t1h=t1h+chh+getCarry(t1l,chl)|0;t1l=t1l+Kil|0;t1h=t1h+Kih+getCarry(t1l,Kil)|0;t1l=t1l+Wil|0;t1h=t1h+Wih+getCarry(t1l,Wil)|0;var t2l=sigma0l+majl|0;var t2h=sigma0h+majh+getCarry(t2l,sigma0l)|0;hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;el=dl+t1l|0;eh=dh+t1h+getCarry(el,dl)|0;dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;al=t1l+t2l|0;ah=t1h+t2h+getCarry(al,t1l)|0}this._al=this._al+al|0;this._bl=this._bl+bl|0;this._cl=this._cl+cl|0;this._dl=this._dl+dl|0;this._el=this._el+el|0;this._fl=this._fl+fl|0;this._gl=this._gl+gl|0;this._hl=this._hl+hl|0;this._ah=this._ah+ah+getCarry(this._al,al)|0;this._bh=this._bh+bh+getCarry(this._bl,bl)|0;this._ch=this._ch+ch+getCarry(this._cl,cl)|0;this._dh=this._dh+dh+getCarry(this._dl,dl)|0;this._eh=this._eh+eh+getCarry(this._el,el)|0;this._fh=this._fh+fh+getCarry(this._fl,fl)|0;this._gh=this._gh+gh+getCarry(this._gl,gl)|0;this._hh=this._hh+hh+getCarry(this._hl,hl)|0};Sha512.prototype._hash=function(){var H=new Buffer(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);writeInt64BE(this._gh,this._gl,48);writeInt64BE(this._hh,this._hl,56);return H};module.exports=Sha512}).call(this,require("buffer").Buffer)},{"./hash":20,buffer:28,inherits:19}],27:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],28:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(value instanceof ArrayBuffer){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(ArrayBuffer.isView(obj)||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||string instanceof ArrayBuffer){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){
return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}},{"base64-js":27,ieee754:29}],29:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],30:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],31:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{dup:19}],32:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],33:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}
var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":32,_process:30,inherits:31}],TProEccAPI:[function(require,module,exports){function TProEccAPI(){this.PIN_APP_REPLACE_STRING="3131313100";this.OLD_PIN_APP_REPLACE_STRING="3535353500";this.NEW_PIN_APP_REPLACE_STRING="3636363600";this.PUK_APP_REPLACE_STRING="323232323232323200";this.KEY_APP_REPLACE_STRING="3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333300";this.HASH_APP_REPLACE_STRING="343434343434343434343434343434343434343434343434343434343434343400";this.SLOT_ID_REPLACE_STRING="3700";this.KEY_NAME_APP_REPLACE_STRING="383838383838383838383800";this.OLD_PIN_APP_REPLACE_STRING="3535353500";this.NEW_PIN_APP_REPLACE_STRING="3636363600";this.INIT_APP="0295758C6E40B8B40507FE4E8F7704FF7FEA4C3D3F5F20B2BA36F362E369AFD9D13EF4BC7707B1FA6BC6705B7A25EF56E1DBCD552672E646329AAF3325D59E3A0020001E0000020200FE01FE080180080B800A00000096641100008604000006040102020202020A31313131000006";this.DEINIT_APP="3E56F2C309AEC9F37C278B3982F5A3F2BE69E898F8DB7313A91947EDAC13AD785832A36AAAE0D8C1FA3C60DF999608810DA6B94A8F77C6824AD2519016B53EA1001C001A0000020200FE01FE0814800A000000966401000000641000008201010002";this.UNBLOCK_PIN_APP="694FD71DED6C659D1ABCB83150C102474506DF995469365FB690BFF8268F855E602C4AA2844A3255904E41DEE9EC672F403B9320C4059A571DB08DB6A825770F002E002C0000020200FE01FE0400000208010400000B04030801800804800803800A0000009664000000006411000082010132323232323232320031313131000002";this.CHANGE_PIN_APP="273267F321E65C22CA406B0E5AD503753AD595DB1FBED35C085AFD821247ACE9131BF9C7292CEEC2B92C8CDD3B9264E6634436B20332B5151D7772CA059641890030002E00C8020300FE01FE03FE0400000204010400000704030801800804800809800A00000096640000000064110000820505353535350036363636000002";this.GENERATE_KEY_APP="E7455BEBA8C95FC41608AD18ACB1C7ADB1AB25CD1694E34ECB7CC8FD01CF03B58896D08BC336693838DCE0E25F75D3738496E0E3AF1A5F174D3D3655636CEE440028002600C8020300FE01FE03FE0400000604010400000B0B09080180081E800A00000096641100008602020202020A31313131003838383838383838383838000006";this.DELETE_KEY_APP="BED617E1127255799DC66FEE9AB9DEBA06844B488CC6B8925FAB714DCFE83AAA55021BA12F7C6C87DC68CD4F11D9D4BB3D37ECC3F87A6F940C8AB60FFA4256890028002600C8020300FE01FE03FE040000020401040000074008080180080E800A0000009664100000820101313131310033333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333000002";this.GET_PUB_KEY_APP="8611A9B741DAA404198CC43FE44C24B93355BAB422EDF862714C2A1AD45544C1DDFB55836F00D72A6416B3CC4017E0B9CCF987A19D1A9F2229831BB4CFE5DCDE001A001800C8020300FE01FE03FE0400000001010820800A0000800137000000";this.SIGN_APP="954159E1F4B61FB24BF14E929C2E43A8C2F229FC3E484FE5C60AC72E300C9AF528A6FB709D70FC89EC7DA1F2EDC2E4BC92D1114ED7B12BEEBF9FCE1D9D359977002E002C00C8020300FE01FE03FE0400000604010400000B20060400002C40080801800811800A0000009664100000860A0202020202313131310034343434343434343434343434343434343434343434343434343434343434340033333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333000006";this.GET_TOKEN_INFO_APP="230BE8BA6BE652D30F4D5F3C769E6A487DEB755F341F310868326D138A4D4317D196ED6DCCAF471EE37502F7EDFD8A487F92A7DAB9A39CED58507D2B2E16FA8E001200100000020200FE01FE0825800A000080010000";this.GET_PUK_APP="710F2ADA01A005F8EFDAAD3A545C21A1052138785DC18A999CCFA6BFFF1A66F23054D99767EE6B51B146B6F24DF4FDDC3FE7AC2B9E49EC7FE5821FA4A5C136BE001D001B0000020200FE01FE040000000401081D800A00000096640000000031313131000000";this.GET_CERT_BY_SLOT_APP="9042BD2D917E6CC85A00CC53D35CCE65A99A0DDBDF2F27F2D1835E85069D77F53888806CDCA8E4A95066EFCF45439939C7E23BB2FC5262A581474D06E37E1AA1001F001D00C8020300FE01FE03FE04000000010D0822800A000080016410000282370001010000";this.GET_CERT_BY_KEY_APP="A06C4FE5AFB60D1369574C6D7B55A10B05C993CDDB2E4AEFD76AA342CBCBAAD29E2A3F9F4E7380FABB5433FA1DBC4DCC27EC60248E18BE20531337329CFF93B1001F001D00C8020300FE01FE03FE0400000040080822800A000080016411004186333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333330002020202020A0000";this.DEL_CERT_BY_SLOT_APP="ACFE258BC90CA7B7D51ADC29079BA7FABE06A68120BAA84261983FCBD41BD362091A132A47B2802951E3151EA0AD2DAF5662C238AD51A3588598DD3C1B1940B10020001E00C8020300FE01FE03FE04000000040104000005010D08238064110007863131313100370002020202020A0000";this.DEL_CERT_BY_KEY_APP="903407703993E28B88636961187AE10EF1D3696C3196131515D963073DB8238433BFB078F02C14B4F4219A79A1F8140822F290812693DE1B6A7E1AABBD917A200023002100C8020300FE01FE03FE04000000040104000005400808018008238064110046863131313100333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333330002020202020A0000";this.UPDATE_CERT_APP="293522C3606661FB6E28EAC0AFF0F271A0C4ACDF6A9E82A3B9DF8C56CED83A5BA48E8190758CB4F126DB6308E152280F52B8C7A014EEDCCFF24EEAF811CB0CF40020001E00C8020300FE01FE03FE04000000400806004104000E0821800A000080003333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333300000432323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232000000";this.UPDATE_CERT_APP_CERT_LENGTH_REPLACE_STRING="AAAA";this.UPDATE_CERT_APP_CERT_REPLACE_STRING="32323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232";this.CHANGE_PIN_APP="273267F321E65C22CA406B0E5AD503753AD595DB1FBED35C085AFD821247ACE9131BF9C7292CEEC2B92C8CDD3B9264E6634436B20332B5151D7772CA059641890030002E00C8020300FE01FE03FE0400000204010400000704030801800804800809800A00000096640000000064110000820505353535350036363636000002";var communication=require("./helpers/ws.js");this.c=new communication;var utils=require("./helpers/functions.js");this.u=new utils;var err=require("./helpers/errorCodes.js");this.e=new err}TProEccAPI.prototype.init=function(param,callback){var app=this.INIT_APP;var pinHex=this.u.stringToHex(param);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.deinit=function(callback){var app=this.DEINIT_APP;this.c.doConnect(app,callback)};TProEccAPI.prototype.changePin=function(param,callback){var app=this.CHANGE_PIN_APP;var oldPinHex=this.u.stringToHex(param.oldPin);var newPinHex=this.u.stringToHex(param.newPin);app=this.u.replaceRes(app,this.OLD_PIN_APP_REPLACE_STRING,oldPinHex);app=this.u.replaceRes(app,this.NEW_PIN_APP_REPLACE_STRING,newPinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.getTokenInfo=function(callback){var app=this.GET_TOKEN_INFO_APP;this.c.doConnect(app,callback)};TProEccAPI.prototype.unblockPin=function(param,callback){var app=this.UNBLOCK_PIN_APP;var pukHex=param.puk;var pinHex=this.u.stringToHex(param.pin);app=this.u.replaceRes(app,this.PUK_APP_REPLACE_STRING,pukHex);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.generateKey=function(param,callback){var app=this.GENERATE_KEY_APP;var pinHex=this.u.stringToHex(param.pin);var nameHex=this.u.stringToHex(param.name);app=this.u.replaceRes(app,this.KEY_NAME_APP_REPLACE_STRING,nameHex);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.deleteKey=function(param,callback){var app=this.DELETE_KEY_APP;var pinHex=this.u.stringToHex(param.pin);var keyHex=param.pubKey;app=this.u.replaceRes(app,this.KEY_APP_REPLACE_STRING,keyHex);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.getPubKey=function(param,callback){var app=this.GET_PUB_KEY_APP;var idHex=this.u.decToHex(parseInt(param));app=this.u.replaceRes(app,this.SLOT_ID_REPLACE_STRING,idHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.sign=function(param,callback){var app=this.SIGN_APP;var pinHex=this.u.stringToHex(param.pin);var hashHex=param.dgst;var keyHex=param.pubKey;app=this.u.replaceRes(app,this.HASH_APP_REPLACE_STRING,hashHex);app=this.u.replaceRes(app,this.KEY_APP_REPLACE_STRING,keyHex);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.getPuk=function(param,callback){var app=this.GET_PUK_APP;var pinHex=this.u.stringToHex(param);app=this.u.replaceRes(app,this.PIN_APP_REPLACE_STRING,pinHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.writeCertificate=function(param,callback){var app=this.UPDATE_CERT_APP;var certHex=param.cert;var keyHex=param.pubKey;app=this.u.replaceResAndSize(app,this.UPDATE_CERT_APP_CERT_REPLACE_STRING,certHex);app=this.u.replaceRes(app,this.KEY_APP_REPLACE_STRING,keyHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.getCert=function(param,callback){var app=this.GET_CERT_BY_KEY_APP;var keyHex=param;app=this.u.replaceRes(app,this.KEY_APP_REPLACE_STRING,keyHex);this.c.doConnect(app,callback)};TProEccAPI.prototype.dgst=function(msg){var createHash=require("sha.js");var sha256=createHash("sha256");return sha256.update(msg).digest("hex")};module.exports=TProEccAPI},{"./helpers/errorCodes.js":"/helpers/errorCodes.js","./helpers/functions.js":"/helpers/functions.js","./helpers/ws.js":"/helpers/ws.js","sha.js":"sha.js"}],bson:[function(require,module,exports){(function(Buffer){"use strict";var writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754,Map=require("./map"),Long=require("./long"),Double=require("./double"),Timestamp=require("./timestamp"),ObjectID=require("./objectid"),BSONRegExp=require("./regexp"),Symbol=require("./symbol"),Int32=require("./int_32"),Code=require("./code"),Decimal128=require("./decimal128"),MinKey=require("./min_key"),MaxKey=require("./max_key"),DBRef=require("./db_ref"),Binary=require("./binary");var deserialize=require("./parser/deserializer"),serializer=require("./parser/serializer"),calculateObjectSize=require("./parser/calculate_size");var MAXSIZE=1024*1024*17;var buffer=new Buffer(MAXSIZE);var BSON=function(){};BSON.prototype.serialize=function serialize(object,options){options=options||{};var checkKeys=typeof options.checkKeys=="boolean"?options.checkKeys:false;var serializeFunctions=typeof options.serializeFunctions=="boolean"?options.serializeFunctions:false;var ignoreUndefined=typeof options.ignoreUndefined=="boolean"?options.ignoreUndefined:true;var serializationIndex=serializer(buffer,object,checkKeys,0,0,serializeFunctions,ignoreUndefined,[]);var finishedBuffer=new Buffer(serializationIndex);buffer.copy(finishedBuffer,0,0,finishedBuffer.length);return finishedBuffer};BSON.prototype.serializeWithBufferAndIndex=function(object,finalBuffer,options){options=options||{};var checkKeys=typeof options.checkKeys=="boolean"?options.checkKeys:false;var serializeFunctions=typeof options.serializeFunctions=="boolean"?options.serializeFunctions:false;var ignoreUndefined=typeof options.ignoreUndefined=="boolean"?options.ignoreUndefined:true;var startIndex=typeof options.index=="number"?options.index:0;var serializationIndex=serializer(buffer,object,checkKeys,startIndex||0,0,serializeFunctions,ignoreUndefined);buffer.copy(finalBuffer,startIndex,0,serializationIndex);return serializationIndex-1};BSON.prototype.deserialize=function(buffer,options){return deserialize(buffer,options)};BSON.prototype.calculateObjectSize=function(object,options){options=options||{};var serializeFunctions=typeof options.serializeFunctions=="boolean"?options.serializeFunctions:false;var ignoreUndefined=typeof options.ignoreUndefined=="boolean"?options.ignoreUndefined:true;return calculateObjectSize(object,serializeFunctions,ignoreUndefined)};BSON.prototype.deserializeStream=function(data,startIndex,numberOfDocuments,documents,docStartIndex,options){options=options!=null?options:{};var index=startIndex;for(var i=0;i<numberOfDocuments;i++){var size=data[index]|data[index+1]<<8|data[index+2]<<16|data[index+3]<<24;options["index"]=index;documents[docStartIndex+i]=this.deserialize(data,options);index=index+size}return index};BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992);var JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;module.exports=BSON;module.exports.Code=Code;module.exports.Map=Map;module.exports.Symbol=Symbol;module.exports.BSON=BSON;module.exports.DBRef=DBRef;module.exports.Binary=Binary;module.exports.ObjectID=ObjectID;module.exports.Long=Long;module.exports.Timestamp=Timestamp;module.exports.Double=Double;module.exports.Int32=Int32;module.exports.MinKey=MinKey;module.exports.MaxKey=MaxKey;module.exports.BSONRegExp=BSONRegExp;module.exports.Decimal128=Decimal128}).call(this,require("buffer").Buffer)},{"./binary":1,"./code":2,"./db_ref":3,"./decimal128":4,"./double":5,"./float_parser":6,"./int_32":7,"./long":8,"./map":9,"./max_key":10,"./min_key":11,"./objectid":12,"./parser/calculate_size":13,"./parser/deserializer":14,"./parser/serializer":15,"./regexp":16,"./symbol":17,"./timestamp":18,buffer:28}],"sha.js":[function(require,module,exports){var exports=module.exports=function SHA(algorithm){algorithm=algorithm.toLowerCase();var Algorithm=exports[algorithm];if(!Algorithm)throw new Error(algorithm+" is not supported (we accept pull requests)");return new Algorithm};exports.sha=require("./sha");exports.sha1=require("./sha1");exports.sha224=require("./sha224");exports.sha256=require("./sha256");exports.sha384=require("./sha384");exports.sha512=require("./sha512")},{"./sha":21,"./sha1":22,"./sha224":23,"./sha256":24,"./sha384":25,"./sha512":26}]},{},[]);
